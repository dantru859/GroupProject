import { __assign, __decorate, __metadata, __param } from "tslib";
import { Component, ElementRef, Renderer2, ChangeDetectionStrategy, ChangeDetectorRef, forwardRef, Input, TemplateRef, Optional, Inject } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { getHsvFromHex, getHexFromHsv, isValidHex } from './util';
import { uniqueId } from '../util/util';
import { InputBoolean } from '../util/convert';
import { NGL_COLORPICKER_CONFIG, NglColorpickerConfig } from './config';
var NGL_COLORPICKER_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(function () { return NglColorpicker; }),
    multi: true
};
var NglColorpicker = /** @class */ (function () {
    function NglColorpicker(defaultConfig, el, renderer, cd) {
        this.el = el;
        this.renderer = renderer;
        this.cd = cd;
        /**
         * An input label as for a form.
         */
        this.label = 'Choose Color';
        /**
         * Placeholder of input box.
         */
        this.placeholder = '';
        /**
         * Text for cancel button on popover.
         */
        this.cancelButtonLabel = 'Cancel';
        /**
         * Text for submit button of popover.
         */
        this.submitButtonLabel = 'Done';
        /**
         * Highlights the input as a required field (does not perform any validation).
         */
        this.required = false;
        /**
         * Error message when hex color input is invalid.
         */
        this.invalidColorLabel = 'Please ensure value is correct';
        /**
         * Text for swatch tab of popover.
         */
        this.swatchTabLabel = 'Default';
        /**
         * Text for custom tab of popover.
         */
        this.customTabLabel = 'Custom';
        /**
         * Whether to make the hex color input readonly.
         */
        this.readonlyInput = false;
        /**
         * Determines which tab is visible when popover opens.
         */
        this.defaultSelectedTab = 'swatches';
        this.uid = uniqueId('colorpicker');
        this.hexCurrent = '#FFF';
        this.hsvCurrent = getHsvFromHex(this.hexCurrent);
        this.onChange = function (_) { };
        this.onTouched = function () { };
        this.renderer.addClass(this.el.nativeElement, 'slds-color-picker');
        var config = __assign(__assign({}, new NglColorpickerConfig()), defaultConfig);
        this.swatchColors = config.swatchColors;
        this.variant = config.variant;
    }
    NglColorpicker.prototype.writeValue = function (value) {
        this.color = value || '';
        if (isValidHex(value)) {
            this.hexCurrent = value;
            this.hsvCurrent = getHsvFromHex(value);
        }
        this.cd.detectChanges();
    };
    NglColorpicker.prototype.registerOnChange = function (fn) { this.onChange = fn; };
    NglColorpicker.prototype.registerOnTouched = function (fn) { this.onTouched = fn; };
    NglColorpicker.prototype.setDisabledState = function (isDisabled) { this.disabled = isDisabled; };
    NglColorpicker.prototype.onSwatchSelection = function (hex) {
        this.hsvCurrent = getHsvFromHex(hex);
        this.hexCurrent = hex;
    };
    NglColorpicker.prototype.onCustomSelection = function (hsv) {
        this.hsvCurrent = hsv;
        this.hexCurrent = getHexFromHsv(hsv);
    };
    NglColorpicker.prototype.openChange = function (open) {
        this.open = open;
    };
    NglColorpicker.prototype.cancel = function () {
        this.open = false;
    };
    NglColorpicker.prototype.done = function () {
        this.open = false;
        if (this.hexCurrent !== this.color) {
            this.color = this.hexCurrent;
            this.onChange(this.color);
        }
    };
    NglColorpicker.prototype.canApply = function () {
        return isValidHex(this.hexCurrent);
    };
    NglColorpicker.prototype.onInput = function (hex) {
        this.color = hex;
        if (isValidHex(hex)) {
            this.onSwatchSelection(hex);
            this.onChange(hex);
        }
        else {
            this.onChange(null);
        }
    };
    Object.defineProperty(NglColorpicker.prototype, "isValidInput", {
        get: function () {
            return !this.color || isValidHex(this.color);
        },
        enumerable: true,
        configurable: true
    });
    NglColorpicker.ctorParameters = function () { return [
        { type: NglColorpickerConfig, decorators: [{ type: Optional }, { type: Inject, args: [NGL_COLORPICKER_CONFIG,] }] },
        { type: ElementRef },
        { type: Renderer2 },
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "label", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "placeholder", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "cancelButtonLabel", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "submitButtonLabel", void 0);
    __decorate([
        Input(), InputBoolean(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "required", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "fieldLevelHelpTooltip", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "invalidColorLabel", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "swatchTabLabel", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "customTabLabel", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], NglColorpicker.prototype, "swatchColors", void 0);
    __decorate([
        Input(), InputBoolean(),
        __metadata("design:type", Object)
    ], NglColorpicker.prototype, "readonlyInput", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], NglColorpicker.prototype, "defaultSelectedTab", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], NglColorpicker.prototype, "variant", void 0);
    NglColorpicker = __decorate([
        Component({
            selector: 'ngl-colorpicker',
            template: "\n<div class=\"slds-color-picker__summary slds-form-element\" [class.slds-has-error]=\"!isValidInput\">\n  <label class=\"slds-form-element__label slds-color-picker__summary-label\" [nglFormLabel]=\"label\" [attr.for]=\"uid + '-summary-input'\" [required]=\"required\">\n    <ngl-form-help class=\"slds-m-horizontal_xx-small\" *ngIf=\"fieldLevelHelpTooltip\" [content]=\"fieldLevelHelpTooltip\"></ngl-form-help>\n  </label>\n  <div class=\"slds-form-element__control\">\n    <button class=\"slds-button slds-color-picker__summary-button slds-button_icon slds-button_icon-more\" [title]=\"label\" [nglPopover]=\"tip\" nglPopoverPlacement=\"bottom-left\" [nglPopoverOpen]=\"open\" (nglPopoverOpenChange)=\"openChange($event)\" nglPopoverClass=\"slds-color-picker__selector\" [nglPopoverFooter]=\"footer\" nglPopoverCloseVisible=\"false\" [disabled]=\"disabled\"><span class=\"slds-swatch\" nglColorpickerSwatch [color]=\"isValidInput ? color : hexCurrent\"></span>\n      <svg class=\"slds-button__icon slds-button__icon_small slds-m-left_xx-small\" *ngIf=\"!disabled\" nglIconName=\"utility:down\"></svg><span class=\"slds-assistive-text\">{{ label }}: {{ color }}</span>\n    </button>\n    <div class=\"slds-color-picker__summary-input\">\n      <input class=\"slds-input\" [id]=\"uid + '-summary-input'\" type=\"text\" [value]=\"color\" (input)=\"onInput($event.target.value)\" [disabled]=\"disabled\" [readOnly]=\"readonlyInput\" maxlength=\"7\" [placeholder]=\"placeholder || ''\">\n    </div>\n    <p class=\"slds-form-error\" *ngIf=\"!isValidInput\" [nglInternalOutlet]=\"invalidColorLabel\"></p>\n  </div>\n</div>\n<ng-template #tip>\n  <ng-container [ngSwitch]=\"variant\">\n    <ng-container *ngSwitchCase=\"'swatches'\">\n      <ng-template [ngTemplateOutlet]=\"swatches\"></ng-template>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"'custom'\">\n      <ng-template [ngTemplateOutlet]=\"custom\"></ng-template>\n    </ng-container>\n    <ngl-tabset *ngSwitchDefault [selected]=\"defaultSelectedTab\" (selectedChange)=\"defaultSelectedTab = $event.id\">\n      <ng-template ngl-tab id=\"swatches\" [label]=\"swatchTabLabel\">\n        <ng-template [ngTemplateOutlet]=\"swatches\"></ng-template>\n      </ng-template>\n      <ng-template ngl-tab id=\"custom\" [label]=\"customTabLabel\">\n        <ng-template [ngTemplateOutlet]=\"custom\"></ng-template>\n      </ng-template>\n    </ngl-tabset>\n  </ng-container>\n</ng-template>\n<ng-template #swatches>\n  <ngl-colorpicker-swatches [hex]=\"hexCurrent\" (hexChange)=\"onSwatchSelection($event)\" [swatchColors]=\"swatchColors\"></ngl-colorpicker-swatches>\n</ng-template>\n<ng-template #custom>\n  <ngl-colorpicker-custom [hsv]=\"hsvCurrent\" (hsvChange)=\"onCustomSelection($event)\"></ngl-colorpicker-custom>\n</ng-template>\n<ng-template #footer>\n  <div class=\"slds-color-picker__selector-footer\">\n    <button class=\"slds-button slds-button_neutral\" type=\"button\" (click)=\"cancel()\">{{ cancelButtonLabel }}</button>\n    <button class=\"slds-button slds-button_brand\" type=\"button\" (click)=\"done()\" [disabled]=\"!canApply()\">{{ submitButtonLabel }}</button>\n  </div>\n</ng-template>",
            changeDetection: ChangeDetectionStrategy.OnPush,
            providers: [NGL_COLORPICKER_VALUE_ACCESSOR]
        }),
        __param(0, Optional()), __param(0, Inject(NGL_COLORPICKER_CONFIG)),
        __metadata("design:paramtypes", [NglColorpickerConfig,
            ElementRef,
            Renderer2,
            ChangeDetectorRef])
    ], NglColorpicker);
    return NglColorpicker;
}());
export { NglColorpicker };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3JwaWNrZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1saWdodG5pbmcvIiwic291cmNlcyI6WyJsaWIvY29sb3JwaWNrZXIvY29sb3JwaWNrZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSx1QkFBdUIsRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9KLE9BQU8sRUFBRSxpQkFBaUIsRUFBd0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQVEsYUFBYSxFQUFFLGFBQWEsRUFBRSxVQUFVLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDeEUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUN4QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLHNCQUFzQixFQUFFLG9CQUFvQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRXhFLElBQU0sOEJBQThCLEdBQUc7SUFDckMsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLGNBQU0sT0FBQSxjQUFjLEVBQWQsQ0FBYyxDQUFDO0lBQzdDLEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQztBQVFGO0lBOEVFLHdCQUF3RCxhQUFtQyxFQUN2RSxFQUFjLEVBQ2QsUUFBbUIsRUFDbkIsRUFBcUI7UUFGckIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUEvRXpDOztXQUVHO1FBQ00sVUFBSyxHQUFHLGNBQWMsQ0FBQztRQUVoQzs7V0FFRztRQUNNLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBRTFCOztXQUVHO1FBQ00sc0JBQWlCLEdBQUcsUUFBUSxD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UUFBUixLQUFLLEVBQUU7O21EQUF5QztJQWpFdEMsY0FBYztRQU4xQixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsaUJBQWlCO1lBQzNCLGduR0FBaUM7WUFDakMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07WUFDL0MsU0FBUyxFQUFFLENBQUMsOEJBQThCLENBQUM7U0FDNUMsQ0FBQztRQStFYSxXQUFBLFFBQVEsRUFBRSxDQUFBLEVBQUUsV0FBQSxNQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBQTt5Q0FBZ0Isb0JBQW9CO1lBQ25FLFVBQVU7WUFDSixTQUFTO1lBQ2YsaUJBQWlCO09BakY5QixjQUFjLENBeUoxQjtJQUFELHFCQUFDO0NBQUEsQUF6SkQsSUF5SkM7U0F6SlksY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIGZvcndhcmRSZWYsIElucHV0LCBUZW1wbGF0ZVJlZiwgT3B0aW9uYWwsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgSUhTViwgZ2V0SHN2RnJvbUhleCwgZ2V0SGV4RnJvbUhzdiwgaXNWYWxpZEhleCB9IGZyb20gJy4vdXRpbCc7XG5pbXBvcnQgeyB1bmlxdWVJZCB9IGZyb20gJy4uL3V0aWwvdXRpbCc7XG5pbXBvcnQgeyBJbnB1dEJvb2xlYW4gfSBmcm9tICcuLi91dGlsL2NvbnZlcnQnO1xuaW1wb3J0IHsgTkdMX0NPTE9SUElDS0VSX0NPTkZJRywgTmdsQ29sb3JwaWNrZXJDb25maWcgfSBmcm9tICcuL2NvbmZpZyc7XG5cbmNvbnN0IE5HTF9DT0xPUlBJQ0tFUl9WQUxVRV9BQ0NFU1NPUiA9IHtcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE5nbENvbG9ycGlja2VyKSxcbiAgbXVsdGk6IHRydWVcbn07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25nbC1jb2xvcnBpY2tlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb2xvcnBpY2tlci5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW05HTF9DT0xPUlBJQ0tFUl9WQUxVRV9BQ0NFU1NPUl0sXG59KVxuZXhwb3J0IGNsYXNzIE5nbENvbG9ycGlja2VyIGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3Ige1xuXG4gIC8qKlxuICAgKiBBbiBpbnB1dCBsYWJlbCBhcyBmb3IgYSBmb3JtLlxuICAgKi9cbiAgQElucHV0KCkgbGFiZWwgPSAnQ2hvb3NlIENvbG9yJztcblxuICAvKipcbiAgICogUGxhY2Vob2xkZXIgb2YgaW5wdXQgYm94LlxuICAgKi9cbiAgQElucHV0KCkgcGxhY2Vob2xkZXIgPSAnJztcblxuICAvKipcbiAgICogVGV4dCBmb3IgY2FuY2VsIGJ1dHRvbiBvbiBwb3BvdmVyLlxuICAgKi9cbiAgQElucHV0KCkgY2FuY2VsQnV0dG9uTGFiZWwgPSAnQ2FuY2VsJztcblxuICAvKipcbiAgICogVGV4dCBmb3Igc3VibWl0IGJ1dHRvbiBvZiBwb3BvdmVyLlxuICAgKi9cbiAgQElucHV0KCkgc3VibWl0QnV0dG9uTGFiZWwgPSAnRG9uZSc7XG5cbiAgLyoqXG4gICAqIEhpZ2hsaWdodHMgdGhlIGlucHV0IGFzIGEgcmVxdWlyZWQgZmllbGQgKGRvZXMgbm90IHBlcmZvcm0gYW55IHZhbGlkYXRpb24pLlxuICAgKi9cbiAgQElucHV0KCkgQElucHV0Qm9vbGVhbigpIHJlcXVpcmVkID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEEgdG9vbHRpcCB0aGF0IGlzIGRpc3BsYXllZCBuZXh0IHRvIHRoZSBsYWJlbC5cbiAgICovXG4gIEBJbnB1dCgpIGZpZWxkTGV2ZWxIZWxwVG9vbHRpcDogc3RyaW5nIHwgVGVtcGxhdGVSZWY8YW55PjtcblxuICAvKipcbiAgICogRXJyb3IgbWVzc2FnZSB3aGVuIGhleCBjb2xvciBpbnB1dCBpcyBpbnZhbGlkLlxuICAgKi9cbiAgQElucHV0KCkgaW52YWxpZENvbG9yTGFiZWw6IHN0cmluZyB8IFRlbXBsYXRlUmVmPGFueT4gPSAnUGxlYXNlIGVuc3VyZSB2YWx1ZSBpcyBjb3JyZWN0JztcblxuICAvKipcbiAgICogVGV4dCBmb3Igc3dhdGNoIHRhYiBvZiBwb3BvdmVyLlxuICAgKi9cbiAgQElucHV0KCkgc3dhdGNoVGFiTGFiZWwgPSAnRGVmYXVsdCc7XG5cbiAgLyoqXG4gICAqIFRleHQgZm9yIGN1c3RvbSB0YWIgb2YgcG9wb3Zlci5cbiAgICovXG4gIEBJbnB1dCgpIGN1c3RvbVRhYkxhYmVsID0gJ0N1c3RvbSc7XG5cbiAgLyoqXG4gICAqIEhleCBjb2xvciB2YWx1ZXMgd2hpY2ggYXJlIHVzZWQgdG8gc2V0IHRoZSBvcHRpb25zIG9mIHRoZSBzd2F0Y2ggdGFiIG9mIHRoZSBjb2xvcnBpY2tlciBwb3BvdmVyLlxuICAgKi9cbiAgQElucHV0KCkgc3dhdGNoQ29sb3JzOiBzdHJpbmdbXTtcblxuICAvKipcbiAgICogV2hldGhlciB0byBtYWtlIHRoZSBoZXggY29sb3IgaW5wdXQgcmVhZG9ubHkuXG4gICAqL1xuICBASW5wdXQoKSBASW5wdXRCb29sZWFuKCkgcmVhZG9ubHlJbnB1dCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIHdoaWNoIHRhYiBpcyB2aXNpYmxlIHdoZW4gcG9wb3ZlciBvcGVucy5cbiAgICovXG4gIEBJbnB1dCgpIGRlZmF1bHRTZWxlY3RlZFRhYjogJ3N3YXRjaGVzJyB8ICdjdXN0b20nID0gJ3N3YXRjaGVzJztcblxuICAvKipcbiAgICogQ29uZmlndXJlcyB0byBzaG93IGJvdGggb3Igd2hpY2ggb25lIG9mIHRoZSBjb2xvciBzZWxlY3Rpb24gaW50ZXJmYWNlcy5cbiAgICovXG4gIEBJbnB1dCgpIHZhcmlhbnQ6ICdiYXNlJyB8ICdzd2F0Y2hlcycgfCAnY3VzdG9tJztcblxuICBjb2xvcjogc3RyaW5nO1xuXG4gIHVpZCA9IHVuaXF1ZUlkKCdjb2xvcnBpY2tlcicpO1xuXG4gIG9wZW46IGJvb2xlYW47XG5cbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG5cbiAgaGV4Q3VycmVudCA9ICcjRkZGJztcbiAgaHN2Q3VycmVudCA9IGdldEhzdkZyb21IZXgodGhpcy5oZXhDdXJyZW50KTtcblxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBASW5qZWN0KE5HTF9DT0xPUlBJQ0tFUl9DT05GSUcpIGRlZmF1bHRDb25maWc6IE5nbENvbG9ycGlja2VyQ29uZmlnLFxuICAgICAgICAgICAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgICAgICAgICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdzbGRzLWNvbG9yLXBpY2tlcicpO1xuXG4gICAgY29uc3QgY29uZmlnID0geyAuLi5uZXcgTmdsQ29sb3JwaWNrZXJDb25maWcoKSwgLi4uZGVmYXVsdENvbmZpZyB9O1xuICAgIHRoaXMuc3dhdGNoQ29sb3JzID0gY29uZmlnLnN3YXRjaENvbG9ycztcbiAgICB0aGlzLnZhcmlhbnQgPSBjb25maWcudmFyaWFudDtcbiAgfVxuXG4gIG9uQ2hhbmdlID0gKF86IGFueSkgPT4ge307XG5cbiAgb25Ub3VjaGVkID0gKCkgPT4ge307XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5jb2xvciA9IHZhbHVlIHx8ICcnO1xuICAgIGlmIChpc1ZhbGlkSGV4KHZhbHVlKSkge1xuICAgICAgdGhpcy5oZXhDdXJyZW50ID0gdmFsdWU7XG4gICAgICB0aGlzLmhzdkN1cnJlbnQgPSBnZXRIc3ZGcm9tSGV4KHZhbHVlKTtcbiAgICB9XG5cbiAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2YWx1ZTogYW55KSA9PiBhbnkpOiB2b2lkIHsgdGhpcy5vbkNoYW5nZSA9IGZuOyB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IGFueSk6IHZvaWQgeyB0aGlzLm9uVG91Y2hlZCA9IGZuOyB9XG5cbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKSB7IHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkOyB9XG5cbiAgb25Td2F0Y2hTZWxlY3Rpb24oaGV4OiBzdHJpbmcpIHtcbiAgICB0aGlzLmhzdkN1cnJlbnQgPSBnZXRIc3ZGcm9tSGV4KGhleCk7XG4gICAgdGhpcy5oZXhDdXJyZW50ID0gaGV4O1xuICB9XG5cbiAgb25DdXN0b21TZWxlY3Rpb24oaHN2OiBJSFNWKSB7XG4gICAgdGhpcy5oc3ZDdXJyZW50ID0gaHN2O1xuICAgIHRoaXMuaGV4Q3VycmVudCA9IGdldEhleEZyb21Ic3YoaHN2KTtcbiAgfVxuXG4gIG9wZW5DaGFuZ2Uob3BlbjogYm9vbGVhbikge1xuICAgIHRoaXMub3BlbiA9IG9wZW47XG4gIH1cblxuICBjYW5jZWwoKSB7XG4gICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gIH1cblxuICBkb25lKCkge1xuICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgIGlmICh0aGlzLmhleEN1cnJlbnQgIT09IHRoaXMuY29sb3IpIHtcbiAgICAgIHRoaXMuY29sb3IgPSB0aGlzLmhleEN1cnJlbnQ7XG4gICAgICB0aGlzLm9uQ2hhbmdlKHRoaXMuY29sb3IpO1xuICAgIH1cbiAgfVxuXG4gIGNhbkFwcGx5KCkge1xuICAgIHJldHVybiBpc1ZhbGlkSGV4KHRoaXMuaGV4Q3VycmVudCk7XG4gIH1cblxuICBvbklucHV0KGhleDogc3RyaW5nKSB7XG4gICAgdGhpcy5jb2xvciA9IGhleDtcblxuICAgIGlmIChpc1ZhbGlkSGV4KGhleCkpIHtcbiAgICAgIHRoaXMub25Td2F0Y2hTZWxlY3Rpb24oaGV4KTtcbiAgICAgIHRoaXMub25DaGFuZ2UoaGV4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vbkNoYW5nZShudWxsKTtcbiAgICB9XG4gIH1cblxuICBnZXQgaXNWYWxpZElucHV0KCkge1xuICAgIHJldHVybiAhdGhpcy5jb2xvciB8fCBpc1ZhbGlkSGV4KHRoaXMuY29sb3IpO1xuICB9XG59XG4iXX0=