import { __decorate, __metadata, __param } from "tslib";
import { Component, Input, ChangeDetectionStrategy, ContentChildren, QueryList, Output, EventEmitter, ViewChildren, ViewChild, ElementRef, Optional, Inject } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { LEFT_ARROW, RIGHT_ARROW } from '@angular/cdk/keycodes';
import { InputBoolean, InputNumber } from '../util/convert';
import { NglCarouselImage } from './carousel-image';
import { NglCarouselIndicator } from './carousel-indicator';
var NglCarousel = /** @class */ (function () {
    function NglCarousel(document) {
        this.document = document;
        this.activeChange = new EventEmitter();
        /**
         * The auto scroll duration in seconds. After that the next image is displayed.
         */
        this.scrollDuration = 5;
        /**
         * Whether auto scroll is enabled.
         */
        this.autoScroll = true;
        /**
         * Whether the carousel should continue looping from the beginning after the last item is displayed.
         */
        this.autoRefresh = true;
        this.labels = {
            startAutoPlay: 'Start auto-play',
            stopAutoPlay: 'Stop auto-play',
        };
        this.playing = true;
        this.nextTimer = null;
    }
    NglCarousel.prototype.isActive = function (index) {
        return index === this.active;
    };
    NglCarousel.prototype.getImage = function (index) {
        return this.images.toArray()[index];
    };
    NglCarousel.prototype.ngOnChanges = function (changes) {
        if (changes.active) {
            // Focus correct indicator if one is already focused
            if (this.document && this.indicatorsEl.nativeElement.contains(document.activeElement)) {
                this.indicators.toArray()[this.active].focus();
            }
        }
        if (changes.active || changes.autoScroll || changes.scrollDuration) {
            // Reset timer when active changes
            this.setTimer();
        }
    };
    NglCarousel.prototype.onIndicatorClick = function (index) {
        this.setActive(index, true);
    };
    NglCarousel.prototype.onKeyboard = function (evt) {
        if (evt.keyCode === LEFT_ARROW || evt.keyCode === RIGHT_ARROW) {
            this.activateNext(evt.keyCode === LEFT_ARROW);
        }
    };
    NglCarousel.prototype.setActive = function (index, stopPlaying) {
        if (stopPlaying === void 0) { stopPlaying = false; }
        if (stopPlaying) {
            this.playing = false;
        }
        if (this.active !== index) {
            this.activeChange.emit(index);
        }
    };
    NglCarousel.prototype.togglePlay = function () {
        this.playing = !this.playing;
        this.setTimer();
    };
    NglCarousel.prototype.playLabel = function () {
        return this.labels[this.playing ? 'stopAutoPlay' : 'startAutoPlay'];
    };
    NglCarousel.prototype.activateNext = function (reverse) {
        if (reverse === void 0) { reverse = false; }
        var active = this.active + (reverse ? -1 : 1);
        if ((active < 0 || active > this.images.length - 1) && !this.autoRefresh) {
            return;
        }
        this.setActive((this.images.length + active) % this.images.length);
    };
    NglCarousel.prototype.setTimer = function () {
        var _this = this;
        clearTimeout(this.nextTimer);
        if (this.autoScroll && this.playing) {
            this.nextTimer = setTimeout(function () {
                _this.activateNext();
            }, this.scrollDuration * 1000);
        }
    };
    NglCarousel.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [DOCUMENT,] }] }
    ]; };
    __decorate([
        Input(), InputNumber(),
        __metadata("design:type", Object)
    ], NglCarousel.prototype, "active", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], NglCarousel.prototype, "activeChange", void 0);
    __decorate([
        Input(), InputNumber(),
        __metadata("design:type", Object)
    ], NglCarousel.prototype, "scrollDuration", void 0);
    __decorate([
        Input(), InputBoolean(),
        __metadata("design:type", Object)
    ], NglCarousel.prototype, "autoScroll", void 0);
    __decorate([
        Input(), InputBoolean(),
        __metadata("design:type", Object)
    ], NglCarousel.prototype, "autoRefresh", void 0);
    __decorate([
        ContentChildren(NglCarouselImage),
        __metadata("design:type", QueryList)
    ], NglCarousel.prototype, "images", void 0);
    __decorate([
        ViewChildren(NglCarouselIndicator),
        __metadata("design:type", QueryList)
    ], NglCarousel.prototype, "indicators", void 0);
    __decorate([
        ViewChild('indicatorsEl', { static: true }),
        __metadata("design:type", ElementRef)
    ], NglCarousel.prototype, "indicatorsEl", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglCarousel.prototype, "labels", void 0);
    NglCarousel = __decorate([
        Component({
            selector: 'ngl-carousel',
            template: "\n<div class=\"slds-carousel__stage\"><span class=\"slds-carousel__autoplay\" *ngIf=\"autoScroll\">\n    <button class=\"slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small\" [attr.aria-pressed]=\"!playing\" [title]=\"playLabel()\" (click)=\"togglePlay()\">\n      <svg class=\"slds-button__icon\" [nglIconName]=\"playing ? 'utility:pause' : 'utility:right'\"></svg><span class=\"slds-assistive-text\">{{ playLabel() }}</span>\n    </button></span>\n  <div class=\"slds-carousel__panels\" [style.transform]=\"'translateX(' + (-active * 100) + '%)'\">\n    <ng-content></ng-content>\n  </div>\n  <ul class=\"slds-carousel__indicators\" #indicatorsEl role=\"tablist\" (keydown)=\"onKeyboard($event)\">\n    <li class=\"slds-carousel__indicator\" *ngFor=\"let image of images; let i = index\" role=\"presentation\"><a class=\"slds-carousel__indicator-action\" nglCarouselIndicator href=\"javascript:void(0);\" role=\"tab\" [isActive]=\"isActive(i)\" [image]=\"getImage(i)\" [attr.aria-controls]=\"image.uid\" [title]=\"image.header\" (click)=\"onIndicatorClick(i)\"><span class=\"slds-assistive-text\">{{ image.header }}</span></a></li>\n  </ul>\n</div>",
            changeDetection: ChangeDetectionStrategy.OnPush,
            host: {
                '[class.slds-carousel]': 'true',
            }
        }),
        __param(0, Optional()), __param(0, Inject(DOCUMENT)),
        __metadata("design:paramtypes", [Object])
    ], NglCarousel);
    return NglCarousel;
}());
export { NglCarousel };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1saWdodG5pbmcvIiwic291cmNlcyI6WyJsaWIvY2Fyb3VzZWwvY2Fyb3VzZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLHVCQUF1QixFQUFFLGVBQWUsRUFBRSxTQUFTLEVBQzVFLE1BQU0sRUFBRSxZQUFZLEVBQWEsWUFBWSxFQUFpQixTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0gsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDaEUsT0FBTyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQVU1RDtJQW9DRSxxQkFBa0QsUUFBYTtRQUFiLGFBQVEsR0FBUixRQUFRLENBQUs7UUFoQ3JELGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUVwRDs7V0FFRztRQUNxQixtQkFBYyxHQUFHLENBQUMsQ0FBQztRQUUzQzs7V0FFRztRQUNzQixlQUFVLEdBQUcsSUFBSSxDQUFDO1FBRTNDOztXQUVHO1FBQ3NCLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBUTFCLFdBQU0sR0FBRztZQUN6QixhQUFhLEVBQUUsaUJBQWlCO1lBQ2hDLFlBQVksRUFBRSxnQkFBZ0I7U0FDL0IsQ0FBQztRQUVGLFlBQU8sR0FBRyxJQUFJLENBQUM7UUFFUCxjQUFTLEdBQUcsSUFBSSxDQUFDO0lBRXlDLENBQUM7SUFFbkUsOEJBQVEsR0FBUixVQUFTLEtBQWE7UUFDcEIsT0FBTyxL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blN0cmF0ZWd5LCBDb250ZW50Q2hpbGRyZW4sIFF1ZXJ5TGlzdCxcbiAgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIE9uQ2hhbmdlcywgVmlld0NoaWxkcmVuLCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIE9wdGlvbmFsLCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IExFRlRfQVJST1csIFJJR0hUX0FSUk9XIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7IElucHV0Qm9vbGVhbiwgSW5wdXROdW1iZXIgfSBmcm9tICcuLi91dGlsL2NvbnZlcnQnO1xuaW1wb3J0IHsgTmdsQ2Fyb3VzZWxJbWFnZSB9IGZyb20gJy4vY2Fyb3VzZWwtaW1hZ2UnO1xuaW1wb3J0IHsgTmdsQ2Fyb3VzZWxJbmRpY2F0b3IgfSBmcm9tICcuL2Nhcm91c2VsLWluZGljYXRvcic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25nbC1jYXJvdXNlbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9jYXJvdXNlbC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIGhvc3Q6IHtcbiAgICAnW2NsYXNzLnNsZHMtY2Fyb3VzZWxdJzogJ3RydWUnLFxuICB9LFxufSlcbmV4cG9ydCBjbGFzcyBOZ2xDYXJvdXNlbCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG5cbiAgQElucHV0KCkgQElucHV0TnVtYmVyKCkgcmVhZG9ubHkgYWN0aXZlO1xuXG4gIEBPdXRwdXQoKSBhY3RpdmVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcblxuICAvKipcbiAgICogVGhlIGF1dG8gc2Nyb2xsIGR1cmF0aW9uIGluIHNlY29uZHMuIEFmdGVyIHRoYXQgdGhlIG5leHQgaW1hZ2UgaXMgZGlzcGxheWVkLlxuICAgKi9cbiAgQElucHV0KCkgQElucHV0TnVtYmVyKCkgc2Nyb2xsRHVyYXRpb24gPSA1O1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIGF1dG8gc2Nyb2xsIGlzIGVuYWJsZWQuXG4gICAqL1xuICBASW5wdXQoKSBASW5wdXRCb29sZWFuKCkgYXV0b1Njcm9sbCA9IHRydWU7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGNhcm91c2VsIHNob3VsZCBjb250aW51ZSBsb29waW5nIGZyb20gdGhlIGJlZ2lubmluZyBhZnRlciB0aGUgbGFzdCBpdGVtIGlzIGRpc3BsYXllZC5cbiAgICovXG4gIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSBhdXRvUmVmcmVzaCA9IHRydWU7XG5cbiAgQENvbnRlbnRDaGlsZHJlbihOZ2xDYXJvdXNlbEltYWdlKSBpbWFnZXM6IFF1ZXJ5TGlzdDxOZ2xDYXJvdXNlbEltYWdlPjtcblxuICBAVmlld0NoaWxkcmVuKE5nbENhcm91c2VsSW5kaWNhdG9yKSBpbmRpY2F0b3JzOiBRdWVyeUxpc3Q8TmdsQ2Fyb3VzZWxJbmRpY2F0b3I+O1xuXG4gIEBWaWV3Q2hpbGQoJ2luZGljYXRvcnNFbCcsIHsgc3RhdGljOiB0cnVlIH0pIGluZGljYXRvcnNFbDogRWxlbWVudFJlZjxIVE1MRWxlbWVudD47XG5cbiAgQElucHV0KCkgcmVhZG9ubHkgbGFiZWxzID0ge1xuICAgIHN0YXJ0QXV0b1BsYXk6ICdTdGFydCBhdXRvLXBsYXknLFxuICAgIHN0b3BBdXRvUGxheTogJ1N0b3AgYXV0by1wbGF5JyxcbiAgfTtcblxuICBwbGF5aW5nID0gdHJ1ZTtcblxuICBwcml2YXRlIG5leHRUaW1lciA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudDogYW55KSB7fVxuXG4gIGlzQWN0aXZlKGluZGV4OiBudW1iZXIpIHtcbiAgICByZXR1cm4gaW5kZXggPT09IHRoaXMuYWN0aXZlO1xuICB9XG5cbiAgZ2V0SW1hZ2UoaW5kZXg6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLmltYWdlcy50b0FycmF5KClbaW5kZXhdO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmIChjaGFuZ2VzLmFjdGl2ZSkge1xuICAgICAgLy8gRm9jdXMgY29ycmVjdCBpbmRpY2F0b3IgaWYgb25lIGlzIGFscmVhZHkgZm9jdXNlZFxuICAgICAgaWYgKHRoaXMuZG9jdW1lbnQgJiYgdGhpcy5pbmRpY2F0b3JzRWwubmF0aXZlRWxlbWVudC5jb250YWlucyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KSkge1xuICAgICAgICB0aGlzLmluZGljYXRvcnMudG9BcnJheSgpW3RoaXMuYWN0aXZlXS5mb2N1cygpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjaGFuZ2VzLmFjdGl2ZSB8fCBjaGFuZ2VzLmF1dG9TY3JvbGwgfHwgY2hhbmdlcy5zY3JvbGxEdXJhdGlvbikge1xuICAgICAgLy8gUmVzZXQgdGltZXIgd2hlbiBhY3RpdmUgY2hhbmdlc1xuICAgICAgdGhpcy5zZXRUaW1lcigpO1xuICAgIH1cbiAgfVxuXG4gIG9uSW5kaWNhdG9yQ2xpY2soaW5kZXg6IG51bWJlcikge1xuICAgIHRoaXMuc2V0QWN0aXZlKGluZGV4LCB0cnVlKTtcbiAgfVxuXG4gIG9uS2V5Ym9hcmQoZXZ0OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKGV2dC5rZXlDb2RlID09PSBMRUZUX0FSUk9XIHx8IGV2dC5rZXlDb2RlID09PSBSSUdIVF9BUlJPVykge1xuICAgICAgdGhpcy5hY3RpdmF0ZU5leHQoZXZ0LmtleUNvZGUgPT09IExFRlRfQVJST1cpO1xuICAgIH1cbiAgfVxuXG4gIHNldEFjdGl2ZShpbmRleDogbnVtYmVyLCBzdG9wUGxheWluZyA9IGZhbHNlKSB7XG4gICAgaWYgKHN0b3BQbGF5aW5nKSB7XG4gICAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hY3RpdmUgIT09IGluZGV4KSB7XG4gICAgICB0aGlzLmFjdGl2ZUNoYW5nZS5lbWl0KGluZGV4KTtcbiAgICB9XG4gIH1cblxuICB0b2dnbGVQbGF5KCkge1xuICAgIHRoaXMucGxheWluZyA9ICF0aGlzLnBsYXlpbmc7XG4gICAgdGhpcy5zZXRUaW1lcigpO1xuICB9XG5cbiAgcGxheUxhYmVsKCkge1xuICAgIHJldHVybiB0aGlzLmxhYmVsc1t0aGlzLnBsYXlpbmcgPyAnc3RvcEF1dG9QbGF5JyA6ICdzdGFydEF1dG9QbGF5J107XG4gIH1cblxuICBwcml2YXRlIGFjdGl2YXRlTmV4dChyZXZlcnNlID0gZmFsc2UpOiB2b2lkIHtcbiAgICBjb25zdCBhY3RpdmUgPSB0aGlzLmFjdGl2ZSArIChyZXZlcnNlID8gLTEgOiAxKTtcblxuICAgIGlmICgoYWN0aXZlIDwgMCB8fCBhY3RpdmUgPiB0aGlzLmltYWdlcy5sZW5ndGggLSAxKSAmJiAhdGhpcy5hdXRvUmVmcmVzaCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc2V0QWN0aXZlKCh0aGlzLmltYWdlcy5sZW5ndGggKyBhY3RpdmUpICUgdGhpcy5pbWFnZXMubGVuZ3RoKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VGltZXIoKSB7XG4gICAgY2xlYXJUaW1lb3V0KHRoaXMubmV4dFRpbWVyKTtcblxuICAgIGlmICh0aGlzLmF1dG9TY3JvbGwgJiYgdGhpcy5wbGF5aW5nKSB7XG4gICAgICB0aGlzLm5leHRUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmFjdGl2YXRlTmV4dCgpO1xuICAgICAgfSwgdGhpcy5zY3JvbGxEdXJhdGlvbiAqIDEwMDApO1xuICAgIH1cbiAgfVxufVxuIl19