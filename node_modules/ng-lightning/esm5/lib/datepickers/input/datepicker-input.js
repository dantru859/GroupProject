import { __assign, __decorate, __metadata, __param, __read, __spread } from "tslib";
import { Component, Input, ChangeDetectionStrategy, ElementRef, Renderer2, TemplateRef, forwardRef, ChangeDetectorRef, Output, EventEmitter, ViewChild, OnInit, Inject, OnChanges, SimpleChanges, OnDestroy, Optional, NgZone, LOCALE_ID } from '@angular/core';
import { NG_VALUE_ACCESSOR, NG_VALIDATORS } from '@angular/forms';
import { CdkConnectedOverlay } from '@angular/cdk/overlay';
import { FocusTrapFactory, FocusTrap } from '@angular/cdk/a11y';
import { DOWN_ARROW, UP_ARROW } from '@angular/cdk/keycodes';
import { BehaviorSubject } from 'rxjs';
import { take } from 'rxjs/operators';
import { uniqueId } from '../../util/util';
import { InputBoolean } from '../../util/convert';
import { HostService } from '../../common/host/host.service';
import { NglDateAdapter } from '../adapters/date-fns-adapter';
import { NGL_DATEPICKER_CONFIG, NglDatepickerConfig } from '../config';
import { DEFAULT_DROPDOWN_POSITIONS } from '../../util/overlay-position';
import { parseDate, isDisabled } from '../util';
var NGL_DATEPICKER_INPUT_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(function () { return NglDatepickerInput; }),
    multi: true
};
var NGL_DATEPICKER_INPUT_VALIDATOR = {
    provide: NG_VALIDATORS,
    useExisting: forwardRef(function () { return NglDatepickerInput; }),
    multi: true
};
var NglDatepickerInput = /** @class */ (function () {
    function NglDatepickerInput(defaultConfig, locale, element, renderer, cd, hostService, ngZone, focusTrapFactory, adapter) {
        this.element = element;
        this.renderer = renderer;
        this.cd = cd;
        this.hostService = hostService;
        this.ngZone = ngZone;
        this.focusTrapFactory = focusTrapFactory;
        this.adapter = adapter;
        /**
         * Placeholder of input.
         */
        this.placeholder = '';
        /**
         * Whether input is readonly and calendar is available for date selection.
         */
        this.readonlyInput = false;
        /**
         * Emits when selected date changes.
         */
        this.valueChange = new EventEmitter();
        /**
         * Text for button to open calendar.
         */
        this.selectDateLabel = 'Select a date';
        this.dateDisabled = null;
        this.uid = uniqueId('datepicker-input');
        this._open = new BehaviorSubject(false);
        this._value = null;
        this.onChange = null;
        this.onTouched = function () { };
        this.validatorChange = function () { };
        this.renderer.addClass(this.element.nativeElement, 'slds-form-element');
        this.renderer.addClass(this.element.nativeElement, 'slds-dropdown-trigger');
        this.renderer.addClass(this.element.nativeElement, 'slds-dropdown-trigger_click');
        this.config = __assign(__assign({}, new NglDatepickerConfig(locale)), defaultConfig);
        this.format = this.config.format;
        this.delimiter = this.config.delimiter;
        this.setPositions(this.config.dropdownAlign);
        this.monthNames = this.config.monthNames;
        this.dayNamesShort = this.config.dayNamesShort;
        this.dayNamesLong = this.config.dayNamesLong;
        this.firstDayOfWeek = this.config.firstDayOfWeek;
        this.showToday = this.config.showToday;
        this.relativeYearFrom = this.config.relativeYearFrom;
        this.relativeYearTo = this.config.relativeYearTo;
        this.openOnInputClick = this.config.openOnInputClick;
        this.todayLabel = this.config.todayLabel;
        this.previousMonthLabel = this.config.previousMonthLabel;
        this.nextMonthLabel = this.config.nextMonthLabel;
    }
    Object.defineProperty(NglDatepickerInput.prototype, "value", {
        get: function () {
            return this._value;
        },
        /**
         * The date value.
         */
        set: function (value) {
            if (value === this._value) {
                return;
            }
            this._value = value;
            if (this.value instanceof Date) {
                this.date = this.value;
                this.formatInputValue();
            }
            else {
                this.updateInputValue(value || '');
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NglDatepickerInput.prototype, "open", {
        get: function () {
            return this._open.value;
        },
        set: function (open) {
            this._open.next(open);
        },
        enumerable: true,
        configurable: true
    });
    NglDatepickerInput.prototype.validate = function (c) {
        var value = c.value;
        if (!value) {
            return null;
        }
        if (!(this.value instanceof Date)) {
            return { 'nglDatepickerInput': { invalid: c.value } };
        }
        var date = parseDate(value);
        if (isDisabled(date, this.dateDisabled, parseDate(this.min), parseDate(this.max))) {
            return { 'nglDatepickerInput': { disabled: c.value } };
        }
        return null;
    };
    NglDatepickerInput.prototype.writeValue = function (value) {
        this.value = value;
        this.cd.markForCheck();
    };
    NglDatepickerInput.prototype.registerOnChange = function (fn) { this.onChange = fn; };
    NglDatepickerInput.prototype.registerOnTouched = function (fn) { this.onTouched = fn; };
    NglDatepickerInput.prototype.registerOnValidatorChange = function (fn) { this.validatorChange = fn; };
    NglDatepickerInput.prototype.setDisabledState = function (disabled) { this.disabled = disabled; };
    NglDatepickerInput.prototype.onBlur = function () {
        if (this.value instanceof Date) {
            this.updateInputValue();
        }
        this.onTouched();
    };
    NglDatepickerInput.prototype.ngOnInit = function () {
        var _this = this;
        this._open.subscribe(function () {
            _this.setHostClass();
            _this.cd.markForCheck();
        });
    };
    NglDatepickerInput.prototype.ngOnChanges = function (changes) {
        if (changes.format || changes.delimiter) {
            this.setPattern();
            if (this.value instanceof Date) {
                this.updateInputValue();
            }
        }
        if (changes.dropdownAlign) {
            this.setPositions(this.dropdownAlign);
        }
        if (changes.min || changes.max) {
            this.validatorChange();
        }
    };
    NglDatepickerInput.prototype.ngOnDestroy = function () {
        this.closeCalendar(false);
    };
    NglDatepickerInput.prototype.onKeyboardInput = function (evt) {
        var keyCode = evt.keyCode;
        if (!this.open && (keyCode === DOWN_ARROW || keyCode === UP_ARROW)) {
            this.openCalendar();
        }
    };
    NglDatepickerInput.prototype.onInputChange = function (value) {
        var date = this.dateParse(value);
        this.emitSelection(date || value);
    };
    NglDatepickerInput.prototype.openCalendar = function () {
        this.open = true;
    };
    NglDatepickerInput.prototype.onAttach = function () {
        this.focusTrap = this.focusTrapFactory.create(this.cdkOverlay.overlayRef.overlayElement);
    };
    NglDatepickerInput.prototype.onDetach = function () {
        if (this.open) {
            this.closeCalendar();
        }
    };
    NglDatepickerInput.prototype.closeCalendar = function (focusInput) {
        if (focusInput === void 0) { focusInput = true; }
        this.open = false;
        if (this.focusTrap) {
            this.focusTrap.destroy();
            this.focusTrap = null;
        }
        if (focusInput) {
            this.inputEl.nativeElement.focus();
        }
    };
    NglDatepickerInput.prototype.onTriggerClick = function (origin) {
        if (origin === 'input' && !this.openOnInputClick) {
            return;
        }
        if (!this.open) {
            this.openCalendar();
        }
        else {
            this.closeCalendar(false);
        }
    };
    NglDatepickerInput.prototype.pickerSelection = function (date) {
        this.emitSelection(date);
        this.closeCalendar();
    };
    NglDatepickerInput.prototype.updateDatepickerSize = function (width, height) {
        var _this = this;
        this.ngZone.onStable.asObservable().pipe(take(1)).subscribe(function () {
            var overlayRef = _this.cdkOverlay.overlayRef;
            overlayRef.updateSize({
                minWidth: width,
                minHeight: height + 4,
            });
            overlayRef.updatePosition();
        });
    };
    NglDatepickerInput.prototype.setPositions = function (align) {
        this.overlayPositions = __spread(DEFAULT_DROPDOWN_POSITIONS[align]);
    };
    NglDatepickerInput.prototype.formatInputValue = function () {
        var inputValue = this.inputEl.nativeElement.value;
        if (!inputValue) {
            this.updateInputValue();
        }
        else {
            var date = this.value;
            var dateNow = this.dateParse(inputValue);
            if (!dateNow || dateNow.getFullYear() !== date.getFullYear() || dateNow.getMonth() !== date.getMonth() || dateNow.getDate() !== date.getDate()) {
                this.updateInputValue();
            }
        }
    };
    NglDatepickerInput.prototype.updateInputValue = function (value) {
        if (value === void 0) { value = this.dateFormat(this.value); }
        this.renderer.setProperty(this.inputEl.nativeElement, 'value', value || '');
    };
    NglDatepickerInput.prototype.dateParse = function (value) {
        return this.adapter.parse(value, this.getPattern());
    };
    NglDatepickerInput.prototype.dateFormat = function (date) {
        return this.adapter.format(date, this.getPattern());
    };
    NglDatepickerInput.prototype.getPattern = function () {
        if (!this.pattern) {
            this.setPattern();
        }
        return this.pattern;
    };
    NglDatepickerInput.prototype.setPattern = function () {
        this.pattern = this.adapter.pattern(this.format || this.config.format, this.delimiter || this.config.delimiter);
    };
    NglDatepickerInput.prototype.emitSelection = function (value) {
        this.valueChange.emit(value);
        if (this.onChange) {
            this.value = value;
            this.onChange(value);
        }
    };
    NglDatepickerInput.prototype.setHostClass = function () {
        var _a;
        this.hostService.updateClass(this.element, (_a = {},
            _a["slds-is-open"] = this.open,
            _a));
    };
    NglDatepickerInput.ctorParameters = function () { return [
        { type: NglDatepickerConfig, decorators: [{ type: Optional }, { type: Inject, args: [NGL_DATEPICKER_CONFIG,] }] },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: ElementRef },
        { type: Renderer2 },
        { type: ChangeDetectorRef },
        { type: HostService },
        { type: NgZone },
        { type: FocusTrapFactory },
        { type: NglDateAdapter }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglDatepickerInput.prototype, "label", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglDatepickerInput.prototype, "placeholder", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], NglDatepickerInput.prototype, "format", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglDatepickerInput.prototype, "delimiter", void 0);
    __decorate([
        Input(), InputBoolean(),
        __metadata("design:type", Boolean)
    ], NglDatepickerInput.prototype, "disabled", void 0);
    __decorate([
        Input(), InputBoolean(),
        __metadata("design:type", Object)
    ], NglDatepickerInput.prototype, "readonlyInput", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], NglDatepickerInput.prototype, "dropdownAlign", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], NglDatepickerInput.prototype, "value", null);
    __decorate([
        Input(), InputBoolean(),
        __metadata("design:type", Boolean)
    ], NglDatepickerInput.prototype, "openOnInputClick", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], NglDatepickerInput.prototype, "valueChange", void 0);
    __decorate([
        ViewChild('inputEl', { static: true }),
        __metadata("design:type", ElementRef)
    ], NglDatepickerInput.prototype, "inputEl", void 0);
    __decorate([
        ViewChild('cdkOverlay'),
        __metadata("design:type", CdkConnectedOverlay)
    ], NglDatepickerInput.prototype, "cdkOverlay", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Date)
    ], NglDatepickerInput.prototype, "min", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Date)
    ], NglDatepickerInput.prototype, "max", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], NglDatepickerInput.prototype, "selectDateLabel", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], NglDatepickerInput.prototype, "monthNames", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], NglDatepickerInput.prototype, "dayNamesShort", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], NglDatepickerInput.prototype, "dayNamesLong", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Number)
    ], NglDatepickerInput.prototype, "firstDayOfWeek", void 0);
    __decorate([
        Input(), InputBoolean(),
        __metadata("design:type", Boolean)
    ], NglDatepickerInput.prototype, "showToday", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Function)
    ], NglDatepickerInput.prototype, "dateDisabled", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Number)
    ], NglDatepickerInput.prototype, "relativeYearFrom", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Number)
    ], NglDatepickerInput.prototype, "relativeYearTo", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], NglDatepickerInput.prototype, "todayLabel", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], NglDatepickerInput.prototype, "previousMonthLabel", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], NglDatepickerInput.prototype, "nextMonthLabel", void 0);
    NglDatepickerInput = __decorate([
        Component({
            selector: 'ngl-datepicker-input',
            template: "\n<label class=\"slds-form-element__label\" *ngIf=\"label\" [attr.for]=\"uid\" [nglInternalOutlet]=\"label\"></label>\n<div class=\"slds-form-element__control slds-input-has-icon slds-input-has-icon_right\" #formEl>\n  <input class=\"slds-input\" #inputEl cdkOverlayOrigin #overlayOrigin=\"cdkOverlayOrigin\" [id]=\"uid\" type=\"text\" autocomplete=\"off\" [placeholder]=\"placeholder\" [disabled]=\"disabled\" [readOnly]=\"readonlyInput\" (click)=\"onTriggerClick('input')\" (keydown)=\"onKeyboardInput($event)\" (input)=\"onInputChange($event.target.value)\" (blur)=\"onBlur()\">\n  <button class=\"slds-button slds-button_icon slds-input__icon slds-input__icon_right\" type=\"button\" [title]=\"selectDateLabel\" [disabled]=\"disabled\" (click)=\"onTriggerClick('button')\">\n    <svg class=\"slds-button__icon\" nglIconName=\"utility:event\"></svg><span class=\"slds-assistive-text\">{{ selectDateLabel }}</span>\n  </button>\n</div>\n<ng-template cdkConnectedOverlay #cdkOverlay=\"cdkConnectedOverlay\" [cdkConnectedOverlayPositions]=\"overlayPositions\" [cdkConnectedOverlayOrigin]=\"overlayOrigin\" [cdkConnectedOverlayOpen]=\"open\" (nglOverlayScrolledOutsideView)=\"closeCalendar(false)\" (attach)=\"onAttach()\" (detach)=\"onDetach()\">\n  <ngl-datepicker class=\"slds-dropdown\" [attr.aria-hidden]=\"!open\" [date]=\"date\" [monthNames]=\"monthNames\" [dayNamesShort]=\"dayNamesShort\" [dayNamesLong]=\"dayNamesLong\" [firstDayOfWeek]=\"firstDayOfWeek\" [showToday]=\"showToday\" [min]=\"min\" [max]=\"max\" [relativeYearFrom]=\"relativeYearFrom\" [relativeYearTo]=\"relativeYearTo\" [todayLabel]=\"todayLabel\" [previousMonthLabel]=\"previousMonthLabel\" [nextMonthLabel]=\"nextMonthLabel\" [dateDisabled]=\"dateDisabled\" (dateChange)=\"pickerSelection($event)\" (nglClickOutside)=\"closeCalendar(false)\" [nglClickOutsideIgnore]=\"formEl\"></ngl-datepicker>\n</ng-template>",
            changeDetection: ChangeDetectionStrategy.OnPush,
            providers: [NGL_DATEPICKER_INPUT_VALUE_ACCESSOR, NGL_DATEPICKER_INPUT_VALIDATOR, HostService]
        }),
        __param(0, Optional()), __param(0, Inject(NGL_DATEPICKER_CONFIG)),
        __param(1, Inject(LOCALE_ID)),
        __metadata("design:paramtypes", [NglDatepickerConfig, String, ElementRef,
            Renderer2,
            ChangeDetectorRef,
            HostService,
            NgZone,
            FocusTrapFactory,
            NglDateAdapter])
    ], NglDatepickerInput);
    return NglDatepickerInput;
}());
export { NglDatepickerInput };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXBpY2tlci1pbnB1dC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLWxpZ2h0bmluZy8iLCJzb3VyY2VzIjpbImxpYi9kYXRlcGlja2Vycy9pbnB1dC9kYXRlcGlja2VyLWlucHV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSx1QkFBdUIsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsaUJBQWlCLEVBQzVHLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEosT0FBTyxFQUFFLGlCQUFpQixFQUF3QixhQUFhLEVBQWdELE1BQU0sZ0JBQWdCLENBQUM7QUFDdEksT0FBTyxFQUFFLG1CQUFtQixFQUEwQixNQUFNLHNCQUFzQixDQUFDO0FBQ25GLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzdELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzdELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM5RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxXQUFXLENB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QXFCLENBQUMsQ0FBQTtRQUN6QyxXQUFBLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQTt5Q0FEd0MsbUJBQW1CLFVBRTVELFVBQVU7WUFDVCxTQUFTO1lBQ2YsaUJBQWlCO1lBQ1IsV0FBVztZQUNoQixNQUFNO1lBQ0ksZ0JBQWdCO1lBQ3pCLGNBQWM7T0FwSWhDLGtCQUFrQixDQThWOUI7SUFBRCx5QkFBQztDQUFBLEFBOVZELElBOFZDO1NBOVZZLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIFRlbXBsYXRlUmVmLCBmb3J3YXJkUmVmLCBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsIE9uSW5pdCwgSW5qZWN0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIE9uRGVzdHJveSwgT3B0aW9uYWwsIE5nWm9uZSwgTE9DQUxFX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTElEQVRPUlMsIFZhbGlkYXRvciwgQWJzdHJhY3RDb250cm9sLCBWYWxpZGF0aW9uRXJyb3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQ2RrQ29ubmVjdGVkT3ZlcmxheSwgQ29ubmVjdGlvblBvc2l0aW9uUGFpciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcbmltcG9ydCB7IEZvY3VzVHJhcEZhY3RvcnksIEZvY3VzVHJhcCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IERPV05fQVJST1csIFVQX0FSUk9XIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IHVuaXF1ZUlkIH0gZnJvbSAnLi4vLi4vdXRpbC91dGlsJztcbmltcG9ydCB7IElucHV0Qm9vbGVhbiB9IGZyb20gJy4uLy4uL3V0aWwvY29udmVydCc7XG5pbXBvcnQgeyBIb3N0U2VydmljZSB9IGZyb20gJy4uLy4uL2NvbW1vbi9ob3N0L2hvc3Quc2VydmljZSc7XG5pbXBvcnQgeyBOZ2xEYXRlQWRhcHRlciB9IGZyb20gJy4uL2FkYXB0ZXJzL2RhdGUtZm5zLWFkYXB0ZXInO1xuaW1wb3J0IHsgTkdMX0RBVEVQSUNLRVJfQ09ORklHLCBOZ2xEYXRlcGlja2VyQ29uZmlnIH0gZnJvbSAnLi4vY29uZmlnJztcbmltcG9ydCB7IERFRkFVTFRfRFJPUERPV05fUE9TSVRJT05TIH0gZnJvbSAnLi4vLi4vdXRpbC9vdmVybGF5LXBvc2l0aW9uJztcbmltcG9ydCB7IHBhcnNlRGF0ZSwgaXNEaXNhYmxlZCB9IGZyb20gJy4uL3V0aWwnO1xuXG5jb25zdCBOR0xfREFURVBJQ0tFUl9JTlBVVF9WQUxVRV9BQ0NFU1NPUiA9IHtcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE5nbERhdGVwaWNrZXJJbnB1dCksXG4gIG11bHRpOiB0cnVlXG59O1xuXG5jb25zdCBOR0xfREFURVBJQ0tFUl9JTlBVVF9WQUxJREFUT1IgPSB7XG4gIHByb3ZpZGU6IE5HX1ZBTElEQVRPUlMsXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE5nbERhdGVwaWNrZXJJbnB1dCksXG4gIG11bHRpOiB0cnVlXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ2wtZGF0ZXBpY2tlci1pbnB1dCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9kYXRlcGlja2VyLWlucHV0Lmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgcHJvdmlkZXJzOiBbTkdMX0RBVEVQSUNLRVJfSU5QVVRfVkFMVUVfQUNDRVNTT1IsIE5HTF9EQVRFUElDS0VSX0lOUFVUX1ZBTElEQVRPUiwgSG9zdFNlcnZpY2VdLFxufSlcbmV4cG9ydCBjbGFzcyBOZ2xEYXRlcGlja2VySW5wdXQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgVmFsaWRhdG9yLCBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcblxuICAvKipcbiAgICogTGFiZWwgdGhhdCBhcHBlYXJzIGFib3ZlIHRoZSBpbnB1dC5cbiAgICovXG4gIEBJbnB1dCgpIGxhYmVsOiBzdHJpbmcgfCBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIC8qKlxuICAgKiBQbGFjZWhvbGRlciBvZiBpbnB1dC5cbiAgICovXG4gIEBJbnB1dCgpIHBsYWNlaG9sZGVyID0gJyc7XG5cbiAgLyoqXG4gICAqIFByZS1kZWZpbmVkIGZvcm1hdCB0byB1c2UuXG4gICAqL1xuICBASW5wdXQoKSBmb3JtYXQ6ICdiaWctZW5kaWFuJyB8ICdsaXR0bGUtZW5kaWFuJyB8ICdtaWRkbGUtZW5kaWFuJztcblxuICAvKipcbiAgICogRGVsaW1pdGVyIHRvIHVzZSBvbiBwcmUtZGVmaW5lZCBmb3JtYXRzLlxuICAgKi9cbiAgQElucHV0KCkgZGVsaW1pdGVyO1xuXG4gIC8qKlxuICAgKiBEaXNhYmxlIGlucHV0IGFuZCBjYWxlbmRhci5cbiAgICovXG4gIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSBkaXNhYmxlZDogYm9vbGVhbjtcblxuICAvKipcbiAgICogV2hldGhlciBpbnB1dCBpcyByZWFkb25seSBhbmQgY2FsZW5kYXIgaXMgYXZhaWxhYmxlIGZvciBkYXRlIHNlbGVjdGlvbi5cbiAgICovXG4gIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSByZWFkb25seUlucHV0ID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEFsaWducyB0aGUgcmlnaHQgb3IgbGVmdCBzaWRlIG9mIHRoZSBkcm9wZG93biBtZW51IHdpdGggdGhlIHJlc3BlY3RpdmUgc2lkZSBvZiB0aGUgaW5wdXQuXG4gICAqL1xuICBASW5wdXQoKSBkcm9wZG93bkFsaWduOiAnbGVmdCcgfCAncmlnaHQnO1xuXG4gIC8qKlxuICAgKiBUaGUgZGF0ZSB2YWx1ZS5cbiAgICovXG4gIEBJbnB1dCgpIHNldCB2YWx1ZSh2YWx1ZTogRGF0ZSB8IHN0cmluZyB8IG51bGwpIHtcbiAgICBpZiAodmFsdWUgPT09IHRoaXMuX3ZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy52YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHRoaXMuZGF0ZSA9IHRoaXMudmFsdWU7XG4gICAgICB0aGlzLmZvcm1hdElucHV0VmFsdWUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51cGRhdGVJbnB1dFZhbHVlKDxzdHJpbmc+dmFsdWUgfHwgJycpO1xuICAgIH1cbiAgfVxuICBnZXQgdmFsdWUoKTogRGF0ZSB8IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIG9wZW4gdGhlIGRhdGVwaWNrZXIgd2hlbiBhIG1vdXNlIHVzZXIgY2xpY2tzIG9uIHRoZSBpbnB1dC5cbiAgICovXG4gIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSBvcGVuT25JbnB1dENsaWNrOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBFbWl0cyB3aGVuIHNlbGVjdGVkIGRhdGUgY2hhbmdlcy5cbiAgICovXG4gIEBPdXRwdXQoKSB2YWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8RGF0ZSB8IHN0cmluZyB8IG51bGw+KCk7XG5cbiAgQFZpZXdDaGlsZCgnaW5wdXRFbCcsIHsgc3RhdGljOiB0cnVlIH0pIGlucHV0RWw6IEVsZW1lbnRSZWY7XG5cbiAgQFZpZXdDaGlsZCgnY2RrT3ZlcmxheScpIGNka092ZXJsYXk6IENka0Nvbm5lY3RlZE92ZXJsYXk7XG5cbiAgLyoqXG4gICAqIFRoZSBtaW5pbXVtIHZhbGlkIGRhdGUuXG4gICAqL1xuICBASW5wdXQoKSByZWFkb25seSBtaW46IERhdGU7XG5cbiAgLyoqXG4gICAqIFRoZSBtYXhpbXVtIHZhbGlkIGRhdGUuXG4gICAqL1xuICBASW5wdXQoKSByZWFkb25seSBtYXg6IERhdGU7XG5cbiAgLyoqXG4gICAqIFRleHQgZm9yIGJ1dHRvbiB0byBvcGVuIGNhbGVuZGFyLlxuICAgKi9cbiAgQElucHV0KCkgcmVhZG9ubHkgc2VsZWN0RGF0ZUxhYmVsID0gJ1NlbGVjdCBhIGRhdGUnO1xuXG4gIC8qKlxuICAgKiBEYXRlcGlja2VyIGlucHV0c1xuICAgKi9cbiAgQElucHV0KCkgbW9udGhOYW1lczogc3RyaW5nW107XG4gIEBJbnB1dCgpIGRheU5hbWVzU2hvcnQ6IHN0cmluZ1tdO1xuICBASW5wdXQoKSBkYXlOYW1lc0xvbmc6IHN0cmluZ1tdO1xuICBASW5wdXQoKSBmaXJzdERheU9mV2VlazogbnVtYmVyO1xuICBASW5wdXQoKSBASW5wdXRCb29sZWFuKCkgc2hvd1RvZGF5OiBib29sZWFuO1xuICBASW5wdXQoKSBkYXRlRGlzYWJsZWQ6IChkYXRlOiBEYXRlKSA9PiBib29sZWFuIHwgbnVsbCA9IG51bGw7XG4gIEBJbnB1dCgpIHJlbGF0aXZlWWVhckZyb206IG51bWJlcjtcbiAgQElucHV0KCkgcmVsYXRpdmVZZWFyVG86IG51bWJlcjtcbiAgQElucHV0KCkgdG9kYXlMYWJlbDogc3RyaW5nO1xuICBASW5wdXQoKSBwcmV2aW91c01vbnRoTGFiZWw6IHN0cmluZztcbiAgQElucHV0KCkgbmV4dE1vbnRoTGFiZWw6IHN0cmluZztcblxuICBkYXRlOiBEYXRlO1xuXG4gIHVpZCA9IHVuaXF1ZUlkKCdkYXRlcGlja2VyLWlucHV0Jyk7XG5cbiAgb3ZlcmxheVBvc2l0aW9uczogQ29ubmVjdGlvblBvc2l0aW9uUGFpcltdO1xuXG4gIHNldCBvcGVuKG9wZW46IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9vcGVuLm5leHQob3Blbik7XG4gIH1cbiAgZ2V0IG9wZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuX29wZW4udmFsdWU7XG4gIH1cblxuICBwcml2YXRlIF9vcGVuID0gbmV3IEJlaGF2aW9yU3ViamVjdChmYWxzZSk7XG5cbiAgcHJpdmF0ZSBfdmFsdWU6IERhdGUgfCBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICBwcml2YXRlIHBhdHRlcm46IHN0cmluZztcblxuICBwcml2YXRlIGNvbmZpZzogTmdsRGF0ZXBpY2tlckNvbmZpZztcblxuICBwcml2YXRlIGZvY3VzVHJhcDogRm9jdXNUcmFwO1xuXG4gIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIEBJbmplY3QoTkdMX0RBVEVQSUNLRVJfQ09ORklHKSBkZWZhdWx0Q29uZmlnOiBOZ2xEYXRlcGlja2VyQ29uZmlnLFxuICAgICAgICAgICAgICBASW5qZWN0KExPQ0FMRV9JRCkgbG9jYWxlOiBzdHJpbmcsXG4gICAgICAgICAgICAgIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICAgICAgICAgICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgICAgICAgICAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgICAgICAgcHJpdmF0ZSBob3N0U2VydmljZTogSG9zdFNlcnZpY2UsXG4gICAgICAgICAgICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXG4gICAgICAgICAgICAgIHByaXZhdGUgZm9jdXNUcmFwRmFjdG9yeTogRm9jdXNUcmFwRmFjdG9yeSxcbiAgICAgICAgICAgICAgcHJpdmF0ZSBhZGFwdGVyOiBOZ2xEYXRlQWRhcHRlcikge1xuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsICdzbGRzLWZvcm0tZWxlbWVudCcpO1xuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsICdzbGRzLWRyb3Bkb3duLXRyaWdnZXInKTtcbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LCAnc2xkcy1kcm9wZG93bi10cmlnZ2VyX2NsaWNrJyk7XG5cbiAgICB0aGlzLmNvbmZpZyA9IHsgLi4ubmV3IE5nbERhdGVwaWNrZXJDb25maWcobG9jYWxlKSwgLi4uZGVmYXVsdENvbmZpZyB9O1xuICAgIHRoaXMuZm9ybWF0ID0gdGhpcy5jb25maWcuZm9ybWF0O1xuICAgIHRoaXMuZGVsaW1pdGVyID0gdGhpcy5jb25maWcuZGVsaW1pdGVyO1xuICAgIHRoaXMuc2V0UG9zaXRpb25zKHRoaXMuY29uZmlnLmRyb3Bkb3duQWxpZ24pO1xuICAgIHRoaXMubW9udGhOYW1lcyA9IHRoaXMuY29uZmlnLm1vbnRoTmFtZXM7XG4gICAgdGhpcy5kYXlOYW1lc1Nob3J0ID0gdGhpcy5jb25maWcuZGF5TmFtZXNTaG9ydDtcbiAgICB0aGlzLmRheU5hbWVzTG9uZyA9IHRoaXMuY29uZmlnLmRheU5hbWVzTG9uZztcbiAgICB0aGlzLmZpcnN0RGF5T2ZXZWVrID0gdGhpcy5jb25maWcuZmlyc3REYXlPZldlZWs7XG4gICAgdGhpcy5zaG93VG9kYXkgPSB0aGlzLmNvbmZpZy5zaG93VG9kYXk7XG4gICAgdGhpcy5yZWxhdGl2ZVllYXJGcm9tID0gdGhpcy5jb25maWcucmVsYXRpdmVZZWFyRnJvbTtcbiAgICB0aGlzLnJlbGF0aXZlWWVhclRvID0gdGhpcy5jb25maWcucmVsYXRpdmVZZWFyVG87XG4gICAgdGhpcy5vcGVuT25JbnB1dENsaWNrID0gdGhpcy5jb25maWcub3Blbk9uSW5wdXRDbGljaztcbiAgICB0aGlzLnRvZGF5TGFiZWwgPSB0aGlzLmNvbmZpZy50b2RheUxhYmVsO1xuICAgIHRoaXMucHJldmlvdXNNb250aExhYmVsID0gdGhpcy5jb25maWcucHJldmlvdXNNb250aExhYmVsO1xuICAgIHRoaXMubmV4dE1vbnRoTGFiZWwgPSB0aGlzLmNvbmZpZy5uZXh0TW9udGhMYWJlbDtcbiAgfVxuXG4gIG9uQ2hhbmdlOiBGdW5jdGlvbiB8IG51bGwgPSBudWxsO1xuXG4gIG9uVG91Y2hlZCA9ICgpID0+IHt9O1xuXG4gIHZhbGlkYXRvckNoYW5nZSA9ICgpID0+IHt9O1xuXG4gIHZhbGlkYXRlKGM6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsIHtcbiAgICBjb25zdCB2YWx1ZSA9IGMudmFsdWU7XG5cbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoISh0aGlzLnZhbHVlIGluc3RhbmNlb2YgRGF0ZSkpIHtcbiAgICAgIHJldHVybiB7ICduZ2xEYXRlcGlja2VySW5wdXQnOiB7IGludmFsaWQ6IGMudmFsdWUgfSB9O1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGUgPSBwYXJzZURhdGUodmFsdWUpO1xuICAgIGlmIChpc0Rpc2FibGVkKGRhdGUsIHRoaXMuZGF0ZURpc2FibGVkLCBwYXJzZURhdGUodGhpcy5taW4pLCBwYXJzZURhdGUodGhpcy5tYXgpKSkge1xuICAgICAgcmV0dXJuIHsgJ25nbERhdGVwaWNrZXJJbnB1dCc6IHsgZGlzYWJsZWQ6IGMudmFsdWUgfSB9O1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogRGF0ZSkge1xuICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogKHZhbHVlOiBhbnkpID0+IGFueSk6IHZvaWQgeyB0aGlzLm9uQ2hhbmdlID0gZm47IH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gYW55KTogdm9pZCB7IHRoaXMub25Ub3VjaGVkID0gZm47IH1cblxuICByZWdpc3Rlck9uVmFsaWRhdG9yQ2hhbmdlKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7IHRoaXMudmFsaWRhdG9yQ2hhbmdlID0gZm47IH1cblxuICBzZXREaXNhYmxlZFN0YXRlKGRpc2FibGVkOiBib29sZWFuKSB7IHRoaXMuZGlzYWJsZWQgPSBkaXNhYmxlZDsgfVxuXG4gIG9uQmx1cigpIHtcbiAgICBpZiAodGhpcy52YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHRoaXMudXBkYXRlSW5wdXRWYWx1ZSgpO1xuICAgIH1cbiAgICB0aGlzLm9uVG91Y2hlZCgpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5fb3Blbi5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5zZXRIb3N0Q2xhc3MoKTtcbiAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKGNoYW5nZXMuZm9ybWF0IHx8IGNoYW5nZXMuZGVsaW1pdGVyKSB7XG4gICAgICB0aGlzLnNldFBhdHRlcm4oKTtcbiAgICAgIGlmICh0aGlzLnZhbHVlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICB0aGlzLnVwZGF0ZUlucHV0VmFsdWUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY2hhbmdlcy5kcm9wZG93bkFsaWduKSB7XG4gICAgICB0aGlzLnNldFBvc2l0aW9ucyh0aGlzLmRyb3Bkb3duQWxpZ24pO1xuICAgIH1cblxuICAgIGlmIChjaGFuZ2VzLm1pbiB8fCBjaGFuZ2VzLm1heCkge1xuICAgICAgdGhpcy52YWxpZGF0b3JDaGFuZ2UoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmNsb3NlQ2FsZW5kYXIoZmFsc2UpO1xuICB9XG5cbiAgb25LZXlib2FyZElucHV0KGV2dDogS2V5Ym9hcmRFdmVudCkge1xuICAgIGNvbnN0IGtleUNvZGUgPSBldnQua2V5Q29kZTtcblxuICAgIGlmICghdGhpcy5vcGVuICYmIChrZXlDb2RlID09PSBET1dOX0FSUk9XIHx8IGtleUNvZGUgPT09IFVQX0FSUk9XKSkge1xuICAgICAgdGhpcy5vcGVuQ2FsZW5kYXIoKTtcbiAgICB9XG4gIH1cblxuICBvbklucHV0Q2hhbmdlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICBjb25zdCBkYXRlID0gdGhpcy5kYXRlUGFyc2UodmFsdWUpO1xuICAgIHRoaXMuZW1pdFNlbGVjdGlvbihkYXRlIHx8IHZhbHVlKTtcbiAgfVxuXG4gIG9wZW5DYWxlbmRhcigpIHtcbiAgICB0aGlzLm9wZW4gPSB0cnVlO1xuICB9XG5cbiAgb25BdHRhY2goKSB7XG4gICAgdGhpcy5mb2N1c1RyYXAgPSB0aGlzLmZvY3VzVHJhcEZhY3RvcnkuY3JlYXRlKHRoaXMuY2RrT3ZlcmxheS5vdmVybGF5UmVmLm92ZXJsYXlFbGVtZW50KTtcbiAgfVxuXG4gIG9uRGV0YWNoKCkge1xuICAgIGlmICh0aGlzLm9wZW4pIHtcbiAgICAgIHRoaXMuY2xvc2VDYWxlbmRhcigpO1xuICAgIH1cbiAgfVxuXG4gIGNsb3NlQ2FsZW5kYXIoZm9jdXNJbnB1dCA9IHRydWUpIHtcbiAgICB0aGlzLm9wZW4gPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLmZvY3VzVHJhcCkge1xuICAgICAgdGhpcy5mb2N1c1RyYXAuZGVzdHJveSgpO1xuICAgICAgdGhpcy5mb2N1c1RyYXAgPSBudWxsO1xuICAgIH1cblxuICAgIGlmIChmb2N1c0lucHV0KSB7XG4gICAgICB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIG9uVHJpZ2dlckNsaWNrKG9yaWdpbjogJ2lucHV0JyB8ICdidXR0b24nKSB7XG4gICAgaWYgKG9yaWdpbiA9PT0gJ2lucHV0JyAmJiAhdGhpcy5vcGVuT25JbnB1dENsaWNrKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLm9wZW4pIHtcbiAgICAgIHRoaXMub3BlbkNhbGVuZGFyKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2xvc2VDYWxlbmRhcihmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgcGlja2VyU2VsZWN0aW9uKGRhdGU6IERhdGUpIHtcbiAgICB0aGlzLmVtaXRTZWxlY3Rpb24oZGF0ZSk7XG4gICAgdGhpcy5jbG9zZUNhbGVuZGFyKCk7XG4gIH1cblxuICB1cGRhdGVEYXRlcGlja2VyU2l6ZSh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xuICAgIHRoaXMubmdab25lLm9uU3RhYmxlLmFzT2JzZXJ2YWJsZSgpLnBpcGUodGFrZSgxKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIGNvbnN0IHsgb3ZlcmxheVJlZiB9ID0gdGhpcy5jZGtPdmVybGF5O1xuICAgICAgb3ZlcmxheVJlZi51cGRhdGVTaXplKHtcbiAgICAgICAgbWluV2lkdGg6IHdpZHRoLFxuICAgICAgICBtaW5IZWlnaHQ6IGhlaWdodCArIDQsXG4gICAgICB9KTtcbiAgICAgIG92ZXJsYXlSZWYudXBkYXRlUG9zaXRpb24oKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0UG9zaXRpb25zKGFsaWduOiAnbGVmdCcgfCAncmlnaHQnKSB7XG4gICAgdGhpcy5vdmVybGF5UG9zaXRpb25zID0gWy4uLkRFRkFVTFRfRFJPUERPV05fUE9TSVRJT05TW2FsaWduXV07XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdElucHV0VmFsdWUoKSB7XG4gICAgY29uc3QgaW5wdXRWYWx1ZSA9IHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnZhbHVlO1xuICAgIGlmICghaW5wdXRWYWx1ZSkge1xuICAgICAgdGhpcy51cGRhdGVJbnB1dFZhbHVlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGRhdGUgPSB0aGlzLnZhbHVlIGFzIERhdGU7XG4gICAgICBjb25zdCBkYXRlTm93ID0gdGhpcy5kYXRlUGFyc2UoaW5wdXRWYWx1ZSk7XG5cbiAgICAgIGlmICghZGF0ZU5vdyB8fCBkYXRlTm93LmdldEZ1bGxZZWFyKCkgIT09IGRhdGUuZ2V0RnVsbFllYXIoKSB8fCBkYXRlTm93LmdldE1vbnRoKCkgIT09IGRhdGUuZ2V0TW9udGgoKSB8fCBkYXRlTm93LmdldERhdGUoKSAhPT0gZGF0ZS5nZXREYXRlKCkpIHtcbiAgICAgICAgdGhpcy51cGRhdGVJbnB1dFZhbHVlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVJbnB1dFZhbHVlKHZhbHVlOiBzdHJpbmcgPSB0aGlzLmRhdGVGb3JtYXQoPERhdGU+dGhpcy52YWx1ZSkpIHtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LCAndmFsdWUnLCB2YWx1ZSB8fCAnJyk7XG4gIH1cblxuICBwcml2YXRlIGRhdGVQYXJzZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuYWRhcHRlci5wYXJzZSh2YWx1ZSwgdGhpcy5nZXRQYXR0ZXJuKCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBkYXRlRm9ybWF0KGRhdGU6IERhdGUpIHtcbiAgICByZXR1cm4gdGhpcy5hZGFwdGVyLmZvcm1hdChkYXRlLCB0aGlzLmdldFBhdHRlcm4oKSk7XG4gIH1cblxuICBwcml2YXRlIGdldFBhdHRlcm4oKSB7XG4gICAgaWYgKCF0aGlzLnBhdHRlcm4pIHtcbiAgICAgIHRoaXMuc2V0UGF0dGVybigpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5wYXR0ZXJuO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRQYXR0ZXJuKCkge1xuICAgIHRoaXMucGF0dGVybiA9IHRoaXMuYWRhcHRlci5wYXR0ZXJuKHRoaXMuZm9ybWF0IHx8IHRoaXMuY29uZmlnLmZvcm1hdCwgdGhpcy5kZWxpbWl0ZXIgfHwgdGhpcy5jb25maWcuZGVsaW1pdGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgZW1pdFNlbGVjdGlvbih2YWx1ZTogRGF0ZSB8IHN0cmluZykge1xuICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh2YWx1ZSk7XG5cbiAgICBpZiAodGhpcy5vbkNoYW5nZSkge1xuICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgdGhpcy5vbkNoYW5nZSh2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRIb3N0Q2xhc3MoKSB7XG4gICAgdGhpcy5ob3N0U2VydmljZS51cGRhdGVDbGFzcyh0aGlzLmVsZW1lbnQsIHtcbiAgICAgIFtgc2xkcy1pcy1vcGVuYF06IHRoaXMub3BlbixcbiAgICB9KTtcbiAgfVxufVxuIl19