import { __decorate, __metadata, __param } from "tslib";
import { Directive, Output, EventEmitter, OnInit, OnDestroy, NgZone, Self } from '@angular/core';
import { CdkConnectedOverlay, ScrollDispatcher } from '@angular/cdk/overlay';
let NglOverlaynglOverlayScrolledOutsideViewDirective = class NglOverlaynglOverlayScrolledOutsideViewDirective {
    constructor(cdkOverlay, ngZone, scrollDispatcher) {
        this.cdkOverlay = cdkOverlay;
        this.ngZone = ngZone;
        this.scrollDispatcher = scrollDispatcher;
        this.overlayOutside = new EventEmitter();
    }
    ngOnInit() {
        const elementRef = this.cdkOverlay.origin.elementRef;
        const scrollableAncestors = this.scrollDispatcher.getAncestorScrollContainers(elementRef).map(container => container.getElementRef());
        if (!scrollableAncestors || !scrollableAncestors.length)
            return;
        this.subscription = this.cdkOverlay.positionChange.subscribe(() => {
            const bounds = elementRef.nativeElement.getBoundingClientRect();
            for (let i = 0, n = scrollableAncestors.length; i < n; i++) {
                const ancestorsBounds = scrollableAncestors[i].nativeElement.getBoundingClientRect();
                if (isElementOutside(bounds, ancestorsBounds)) {
                    this.ngZone.run(() => this.overlayOutside.emit());
                    return;
                }
            }
        });
    }
    ngOnDestroy() {
        if (this.subscription) {
            this.subscription.unsubscribe();
            this.subscription = null;
        }
    }
};
NglOverlaynglOverlayScrolledOutsideViewDirective.ctorParameters = () => [
    { type: CdkConnectedOverlay, decorators: [{ type: Self }] },
    { type: NgZone },
    { type: ScrollDispatcher }
];
__decorate([
    Output('nglOverlayScrolledOutsideView'),
    __metadata("design:type", EventEmitter)
], NglOverlaynglOverlayScrolledOutsideViewDirective.prototype, "overlayOutside", void 0);
NglOverlaynglOverlayScrolledOutsideViewDirective = __decorate([
    Directive({
        selector: '[nglOverlayScrolledOutsideView]'
    }),
    __param(0, Self()),
    __metadata("design:paramtypes", [CdkConnectedOverlay,
        NgZone,
        ScrollDispatcher])
], NglOverlaynglOverlayScrolledOutsideViewDirective);
export { NglOverlaynglOverlayScrolledOutsideViewDirective };
/**
 * Gets whether an element is scrolled outside of view by its parent scrolling container.
 * @param element Dimensions of the element (from getBoundingClientRect)
 * @param container Dimensions of element's scrolling container (from getBoundingClientRect)
 * @returns Whether the element is scrolled out of view
 */
export function isElementOutside(element, container) {
    return (element.bottom < container.top || element.top > container.bottom ||
        element.right < container.left || element.left > container.right);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcmxheS1vdXRzaWRlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctbGlnaHRuaW5nLyIsInNvdXJjZXMiOlsibGliL2NvbW1vbi9vdmVybGF5L292ZXJsYXktb3V0c2lkZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVqRyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUs3RSxJQUFhLGdEQUFnRCxHQUE3RCxNQUFhLGdEQUFnRDtJQU0zRCxZQUE0QixVQUErQixFQUN2QyxNQUFjLEVBQ2QsZ0JBQWtDO1FBRjFCLGVBQVUsR0FBVixVQUFVLENBQXFCO1FBQ3ZDLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBTmIsbUJBQWMsR0FBdUIsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQU14QyxDQUFDO0lBRTFELFFBQVE7UUFDTixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7UUFDckQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsMkJBQTJCLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUM7UUFFdEksSUFBSSxDQUFDLG1CQUFtQixJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTTtZQUFFLE9BQU87UUFFaEUsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ2hFLE1BQU0sTUFBTSxHQUFHLFVBQVUsQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUVoRSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsbUJBQW1CLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQzFELE1BQU0sZUFBZSxHQUFHLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO2dCQUNyRixJQUFJLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxlQUFlLENBQUMsRUFBRTtvQkFDN0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO29CQUNsRCxPQUFPO2lCQUNSO2FBQ0Y7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDaEMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7U0FDMUI7SUFDSCxDQUFDO0NBQ0YsQ0FBQTs7WUE3QnlDLG1CQUFtQix1QkFBOUMsSUFBSTtZQUNXLE1BQU07WUFDSSxnQkFBZ0I7O0FBTmI7SUFBeEMsTUFBTSxDQUFDLCtCQUErQixDQUFDOzhCQUFpQixZQUFZO3dGQUE0QjtBQUZ0RixnREFBZ0Q7SUFINUQsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLGlDQUFpQztLQUM1QyxDQUFDO0lBT2EsV0FBQSxJQUFJLEVBQUUsQ0FBQTtxQ0FBcUIsbUJBQW1CO1FBQy9CLE1BQU07UUFDSSxnQkFBZ0I7R0FSM0MsZ0RBQWdELENBbUM1RDtTQW5DWSxnREFBZ0Q7QUFxQzdEOzs7OztHQUtHO0FBQ0gsTUFBTSxVQUFVLGdCQUFnQixDQUFDLE9BQW1CLEVBQUUsU0FBcUI7SUFDekUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDLEdBQUcsSUFBSSxPQUFPLENBQUMsR0FBRyxHQUFHLFNBQVMsQ0FBQyxNQUFNO1FBQ2hFLE9BQU8sQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUM1RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25Jbml0LCBPbkRlc3Ryb3ksIE5nWm9uZSwgU2VsZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBDZGtDb25uZWN0ZWRPdmVybGF5LCBTY3JvbGxEaXNwYXRjaGVyIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbmdsT3ZlcmxheVNjcm9sbGVkT3V0c2lkZVZpZXddJ1xufSlcbmV4cG9ydCBjbGFzcyBOZ2xPdmVybGF5bmdsT3ZlcmxheVNjcm9sbGVkT3V0c2lkZVZpZXdEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG5cbiAgQE91dHB1dCgnbmdsT3ZlcmxheVNjcm9sbGVkT3V0c2lkZVZpZXcnKSBvdmVybGF5T3V0c2lkZTogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IoQFNlbGYoKSBwcml2YXRlIGNka092ZXJsYXk6IENka0Nvbm5lY3RlZE92ZXJsYXksXG4gICAgICAgICAgICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXG4gICAgICAgICAgICAgIHByaXZhdGUgc2Nyb2xsRGlzcGF0Y2hlcjogU2Nyb2xsRGlzcGF0Y2hlcikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICBjb25zdCBlbGVtZW50UmVmID0gdGhpcy5jZGtPdmVybGF5Lm9yaWdpbi5lbGVtZW50UmVmO1xuICAgIGNvbnN0IHNjcm9sbGFibGVBbmNlc3RvcnMgPSB0aGlzLnNjcm9sbERpc3BhdGNoZXIuZ2V0QW5jZXN0b3JTY3JvbGxDb250YWluZXJzKGVsZW1lbnRSZWYpLm1hcChjb250YWluZXIgPT4gY29udGFpbmVyLmdldEVsZW1lbnRSZWYoKSk7XG5cbiAgICBpZiAoIXNjcm9sbGFibGVBbmNlc3RvcnMgfHwgIXNjcm9sbGFibGVBbmNlc3RvcnMubGVuZ3RoKSByZXR1cm47XG5cbiAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IHRoaXMuY2RrT3ZlcmxheS5wb3NpdGlvbkNoYW5nZS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgY29uc3QgYm91bmRzID0gZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMCwgbiA9IHNjcm9sbGFibGVBbmNlc3RvcnMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGFuY2VzdG9yc0JvdW5kcyA9IHNjcm9sbGFibGVBbmNlc3RvcnNbaV0ubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgaWYgKGlzRWxlbWVudE91dHNpZGUoYm91bmRzLCBhbmNlc3RvcnNCb3VuZHMpKSB7XG4gICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMub3ZlcmxheU91dHNpZGUuZW1pdCgpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBHZXRzIHdoZXRoZXIgYW4gZWxlbWVudCBpcyBzY3JvbGxlZCBvdXRzaWRlIG9mIHZpZXcgYnkgaXRzIHBhcmVudCBzY3JvbGxpbmcgY29udGFpbmVyLlxuICogQHBhcmFtIGVsZW1lbnQgRGltZW5zaW9ucyBvZiB0aGUgZWxlbWVudCAoZnJvbSBnZXRCb3VuZGluZ0NsaWVudFJlY3QpXG4gKiBAcGFyYW0gY29udGFpbmVyIERpbWVuc2lvbnMgb2YgZWxlbWVudCdzIHNjcm9sbGluZyBjb250YWluZXIgKGZyb20gZ2V0Qm91bmRpbmdDbGllbnRSZWN0KVxuICogQHJldHVybnMgV2hldGhlciB0aGUgZWxlbWVudCBpcyBzY3JvbGxlZCBvdXQgb2Ygdmlld1xuICovXG5leHBvcnQgZnVuY3Rpb24gaXNFbGVtZW50T3V0c2lkZShlbGVtZW50OiBDbGllbnRSZWN0LCBjb250YWluZXI6IENsaWVudFJlY3QpIHtcbiAgcmV0dXJuIChlbGVtZW50LmJvdHRvbSA8IGNvbnRhaW5lci50b3AgfHwgZWxlbWVudC50b3AgPiBjb250YWluZXIuYm90dG9tIHx8XG4gICAgICAgICAgZWxlbWVudC5yaWdodCA8IGNvbnRhaW5lci5sZWZ0IHx8IGVsZW1lbnQubGVmdCA+IGNvbnRhaW5lci5yaWdodCk7XG59XG4iXX0=