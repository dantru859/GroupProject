import { __decorate, __metadata, __param } from "tslib";
import { Component, ElementRef, Renderer2, ChangeDetectionStrategy, ChangeDetectorRef, forwardRef, Input, TemplateRef, Optional, Inject } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { getHsvFromHex, getHexFromHsv, isValidHex } from './util';
import { uniqueId } from '../util/util';
import { InputBoolean } from '../util/convert';
import { NGL_COLORPICKER_CONFIG, NglColorpickerConfig } from './config';
const NGL_COLORPICKER_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => NglColorpicker),
    multi: true
};
let NglColorpicker = class NglColorpicker {
    constructor(defaultConfig, el, renderer, cd) {
        this.el = el;
        this.renderer = renderer;
        this.cd = cd;
        /**
         * An input label as for a form.
         */
        this.label = 'Choose Color';
        /**
         * Placeholder of input box.
         */
        this.placeholder = '';
        /**
         * Text for cancel button on popover.
         */
        this.cancelButtonLabel = 'Cancel';
        /**
         * Text for submit button of popover.
         */
        this.submitButtonLabel = 'Done';
        /**
         * Highlights the input as a required field (does not perform any validation).
         */
        this.required = false;
        /**
         * Error message when hex color input is invalid.
         */
        this.invalidColorLabel = 'Please ensure value is correct';
        /**
         * Text for swatch tab of popover.
         */
        this.swatchTabLabel = 'Default';
        /**
         * Text for custom tab of popover.
         */
        this.customTabLabel = 'Custom';
        /**
         * Whether to make the hex color input readonly.
         */
        this.readonlyInput = false;
        /**
         * Determines which tab is visible when popover opens.
         */
        this.defaultSelectedTab = 'swatches';
        this.uid = uniqueId('colorpicker');
        this.hexCurrent = '#FFF';
        this.hsvCurrent = getHsvFromHex(this.hexCurrent);
        this.onChange = (_) => { };
        this.onTouched = () => { };
        this.renderer.addClass(this.el.nativeElement, 'slds-color-picker');
        const config = Object.assign(Object.assign({}, new NglColorpickerConfig()), defaultConfig);
        this.swatchColors = config.swatchColors;
        this.variant = config.variant;
    }
    writeValue(value) {
        this.color = value || '';
        if (isValidHex(value)) {
            this.hexCurrent = value;
            this.hsvCurrent = getHsvFromHex(value);
        }
        this.cd.detectChanges();
    }
    registerOnChange(fn) { this.onChange = fn; }
    registerOnTouched(fn) { this.onTouched = fn; }
    setDisabledState(isDisabled) { this.disabled = isDisabled; }
    onSwatchSelection(hex) {
        this.hsvCurrent = getHsvFromHex(hex);
        this.hexCurrent = hex;
    }
    onCustomSelection(hsv) {
        this.hsvCurrent = hsv;
        this.hexCurrent = getHexFromHsv(hsv);
    }
    openChange(open) {
        this.open = open;
    }
    cancel() {
        this.open = false;
    }
    done() {
        this.open = false;
        if (this.hexCurrent !== this.color) {
            this.color = this.hexCurrent;
            this.onChange(this.color);
        }
    }
    canApply() {
        return isValidHex(this.hexCurrent);
    }
    onInput(hex) {
        this.color = hex;
        if (isValidHex(hex)) {
            this.onSwatchSelection(hex);
            this.onChange(hex);
        }
        else {
            this.onChange(null);
        }
    }
    get isValidInput() {
        return !this.color || isValidHex(this.color);
    }
};
NglColorpicker.ctorParameters = () => [
    { type: NglColorpickerConfig, decorators: [{ type: Optional }, { type: Inject, args: [NGL_COLORPICKER_CONFIG,] }] },
    { type: ElementRef },
    { type: Renderer2 },
    { type: ChangeDetectorRef }
];
__decorate([
    Input(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "label", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "placeholder", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "cancelButtonLabel", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "submitButtonLabel", void 0);
__decorate([
    Input(), InputBoolean(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "required", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "fieldLevelHelpTooltip", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "invalidColorLabel", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "swatchTabLabel", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "customTabLabel", void 0);
__decorate([
    Input(),
    __metadata("design:type", Array)
], NglColorpicker.prototype, "swatchColors", void 0);
__decorate([
    Input(), InputBoolean(),
    __metadata("design:type", Object)
], NglColorpicker.prototype, "readonlyInput", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], NglColorpicker.prototype, "defaultSelectedTab", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], NglColorpicker.prototype, "variant", void 0);
NglColorpicker = __decorate([
    Component({
        selector: 'ngl-colorpicker',
        template: "\n<div class=\"slds-color-picker__summary slds-form-element\" [class.slds-has-error]=\"!isValidInput\">\n  <label class=\"slds-form-element__label slds-color-picker__summary-label\" [nglFormLabel]=\"label\" [attr.for]=\"uid + '-summary-input'\" [required]=\"required\">\n    <ngl-form-help class=\"slds-m-horizontal_xx-small\" *ngIf=\"fieldLevelHelpTooltip\" [content]=\"fieldLevelHelpTooltip\"></ngl-form-help>\n  </label>\n  <div class=\"slds-form-element__control\">\n    <button class=\"slds-button slds-color-picker__summary-button slds-button_icon slds-button_icon-more\" [title]=\"label\" [nglPopover]=\"tip\" nglPopoverPlacement=\"bottom-left\" [nglPopoverOpen]=\"open\" (nglPopoverOpenChange)=\"openChange($event)\" nglPopoverClass=\"slds-color-picker__selector\" [nglPopoverFooter]=\"footer\" nglPopoverCloseVisible=\"false\" [disabled]=\"disabled\"><span class=\"slds-swatch\" nglColorpickerSwatch [color]=\"isValidInput ? color : hexCurrent\"></span>\n      <svg class=\"slds-button__icon slds-button__icon_small slds-m-left_xx-small\" *ngIf=\"!disabled\" nglIconName=\"utility:down\"></svg><span class=\"slds-assistive-text\">{{ label }}: {{ color }}</span>\n    </button>\n    <div class=\"slds-color-picker__summary-input\">\n      <input class=\"slds-input\" [id]=\"uid + '-summary-input'\" type=\"text\" [value]=\"color\" (input)=\"onInput($event.target.value)\" [disabled]=\"disabled\" [readOnly]=\"readonlyInput\" maxlength=\"7\" [placeholder]=\"placeholder || ''\">\n    </div>\n    <p class=\"slds-form-error\" *ngIf=\"!isValidInput\" [nglInternalOutlet]=\"invalidColorLabel\"></p>\n  </div>\n</div>\n<ng-template #tip>\n  <ng-container [ngSwitch]=\"variant\">\n    <ng-container *ngSwitchCase=\"'swatches'\">\n      <ng-template [ngTemplateOutlet]=\"swatches\"></ng-template>\n    </ng-container>\n    <ng-container *ngSwitchCase=\"'custom'\">\n      <ng-template [ngTemplateOutlet]=\"custom\"></ng-template>\n    </ng-container>\n    <ngl-tabset *ngSwitchDefault [selected]=\"defaultSelectedTab\" (selectedChange)=\"defaultSelectedTab = $event.id\">\n      <ng-template ngl-tab id=\"swatches\" [label]=\"swatchTabLabel\">\n        <ng-template [ngTemplateOutlet]=\"swatches\"></ng-template>\n      </ng-template>\n      <ng-template ngl-tab id=\"custom\" [label]=\"customTabLabel\">\n        <ng-template [ngTemplateOutlet]=\"custom\"></ng-template>\n      </ng-template>\n    </ngl-tabset>\n  </ng-container>\n</ng-template>\n<ng-template #swatches>\n  <ngl-colorpicker-swatches [hex]=\"hexCurrent\" (hexChange)=\"onSwatchSelection($event)\" [swatchColors]=\"swatchColors\"></ngl-colorpicker-swatches>\n</ng-template>\n<ng-template #custom>\n  <ngl-colorpicker-custom [hsv]=\"hsvCurrent\" (hsvChange)=\"onCustomSelection($event)\"></ngl-colorpicker-custom>\n</ng-template>\n<ng-template #footer>\n  <div class=\"slds-color-picker__selector-footer\">\n    <button class=\"slds-button slds-button_neutral\" type=\"button\" (click)=\"cancel()\">{{ cancelButtonLabel }}</button>\n    <button class=\"slds-button slds-button_brand\" type=\"button\" (click)=\"done()\" [disabled]=\"!canApply()\">{{ submitButtonLabel }}</button>\n  </div>\n</ng-template>",
        changeDetection: ChangeDetectionStrategy.OnPush,
        providers: [NGL_COLORPICKER_VALUE_ACCESSOR]
    }),
    __param(0, Optional()), __param(0, Inject(NGL_COLORPICKER_CONFIG)),
    __metadata("design:paramtypes", [NglColorpickerConfig,
        ElementRef,
        Renderer2,
        ChangeDetectorRef])
], NglColorpicker);
export { NglColorpicker };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3JwaWNrZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1saWdodG5pbmcvIiwic291cmNlcyI6WyJsaWIvY29sb3JwaWNrZXIvY29sb3JwaWNrZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSx1QkFBdUIsRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9KLE9BQU8sRUFBRSxpQkFBaUIsRUFBd0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQVEsYUFBYSxFQUFFLGFBQWEsRUFBRSxVQUFVLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDeEUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUN4QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLHNCQUFzQixFQUFFLG9CQUFvQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRXhFLE1BQU0sOEJBQThCLEdBQUc7SUFDckMsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLGNBQWMsQ0FBQztJQUM3QyxLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUM7QUFRRixJQUFhLGNBQWMsR0FBM0IsTUFBYSxjQUFjO0lBOEV6QixZQUF3RCxhQUFtQyxFQUN2RSxFQUFjLEVBQ2QsUUFBbUIsRUFDbkIsRUFBcUI7UUFGckIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUEvRXpDOztXQUVHO1FBQ00sVUFBSyxHQUFHLGNBQWMsQ0FBQztRQUVoQzs7V0FFRztRQUNNLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBRTFCOztXQUVHO1FB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QixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsaUJBQWlCO1FBQzNCLGduR0FBaUM7UUFDakMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07UUFDL0MsU0FBUyxFQUFFLENBQUMsOEJBQThCLENBQUM7S0FDNUMsQ0FBQztJQStFYSxXQUFBLFFBQVEsRUFBRSxDQUFBLEVBQUUsV0FBQSxNQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBQTtxQ0FBZ0Isb0JBQW9CO1FBQ25FLFVBQVU7UUFDSixTQUFTO1FBQ2YsaUJBQWlCO0dBakY5QixjQUFjLENBeUoxQjtTQXpKWSxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgZm9yd2FyZFJlZiwgSW5wdXQsIFRlbXBsYXRlUmVmLCBPcHRpb25hbCwgSW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiwgQ29udHJvbFZhbHVlQWNjZXNzb3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBJSFNWLCBnZXRIc3ZGcm9tSGV4LCBnZXRIZXhGcm9tSHN2LCBpc1ZhbGlkSGV4IH0gZnJvbSAnLi91dGlsJztcbmltcG9ydCB7IHVuaXF1ZUlkIH0gZnJvbSAnLi4vdXRpbC91dGlsJztcbmltcG9ydCB7IElucHV0Qm9vbGVhbiB9IGZyb20gJy4uL3V0aWwvY29udmVydCc7XG5pbXBvcnQgeyBOR0xfQ09MT1JQSUNLRVJfQ09ORklHLCBOZ2xDb2xvcnBpY2tlckNvbmZpZyB9IGZyb20gJy4vY29uZmlnJztcblxuY29uc3QgTkdMX0NPTE9SUElDS0VSX1ZBTFVFX0FDQ0VTU09SID0ge1xuICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTmdsQ29sb3JwaWNrZXIpLFxuICBtdWx0aTogdHJ1ZVxufTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmdsLWNvbG9ycGlja2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbG9ycGlja2VyLmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgcHJvdmlkZXJzOiBbTkdMX0NPTE9SUElDS0VSX1ZBTFVFX0FDQ0VTU09SXSxcbn0pXG5leHBvcnQgY2xhc3MgTmdsQ29sb3JwaWNrZXIgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG5cbiAgLyoqXG4gICAqIEFuIGlucHV0IGxhYmVsIGFzIGZvciBhIGZvcm0uXG4gICAqL1xuICBASW5wdXQoKSBsYWJlbCA9ICdDaG9vc2UgQ29sb3InO1xuXG4gIC8qKlxuICAgKiBQbGFjZWhvbGRlciBvZiBpbnB1dCBib3guXG4gICAqL1xuICBASW5wdXQoKSBwbGFjZWhvbGRlciA9ICcnO1xuXG4gIC8qKlxuICAgKiBUZXh0IGZvciBjYW5jZWwgYnV0dG9uIG9uIHBvcG92ZXIuXG4gICAqL1xuICBASW5wdXQoKSBjYW5jZWxCdXR0b25MYWJlbCA9ICdDYW5jZWwnO1xuXG4gIC8qKlxuICAgKiBUZXh0IGZvciBzdWJtaXQgYnV0dG9uIG9mIHBvcG92ZXIuXG4gICAqL1xuICBASW5wdXQoKSBzdWJtaXRCdXR0b25MYWJlbCA9ICdEb25lJztcblxuICAvKipcbiAgICogSGlnaGxpZ2h0cyB0aGUgaW5wdXQgYXMgYSByZXF1aXJlZCBmaWVsZCAoZG9lcyBub3QgcGVyZm9ybSBhbnkgdmFsaWRhdGlvbikuXG4gICAqL1xuICBASW5wdXQoKSBASW5wdXRCb29sZWFuKCkgcmVxdWlyZWQgPSBmYWxzZTtcblxuICAvKipcbiAgICogQSB0b29sdGlwIHRoYXQgaXMgZGlzcGxheWVkIG5leHQgdG8gdGhlIGxhYmVsLlxuICAgKi9cbiAgQElucHV0KCkgZmllbGRMZXZlbEhlbHBUb29sdGlwOiBzdHJpbmcgfCBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIC8qKlxuICAgKiBFcnJvciBtZXNzYWdlIHdoZW4gaGV4IGNvbG9yIGlucHV0IGlzIGludmFsaWQuXG4gICAqL1xuICBASW5wdXQoKSBpbnZhbGlkQ29sb3JMYWJlbDogc3RyaW5nIHwgVGVtcGxhdGVSZWY8YW55PiA9ICdQbGVhc2UgZW5zdXJlIHZhbHVlIGlzIGNvcnJlY3QnO1xuXG4gIC8qKlxuICAgKiBUZXh0IGZvciBzd2F0Y2ggdGFiIG9mIHBvcG92ZXIuXG4gICAqL1xuICBASW5wdXQoKSBzd2F0Y2hUYWJMYWJlbCA9ICdEZWZhdWx0JztcblxuICAvKipcbiAgICogVGV4dCBmb3IgY3VzdG9tIHRhYiBvZiBwb3BvdmVyLlxuICAgKi9cbiAgQElucHV0KCkgY3VzdG9tVGFiTGFiZWwgPSAnQ3VzdG9tJztcblxuICAvKipcbiAgICogSGV4IGNvbG9yIHZhbHVlcyB3aGljaCBhcmUgdXNlZCB0byBzZXQgdGhlIG9wdGlvbnMgb2YgdGhlIHN3YXRjaCB0YWIgb2YgdGhlIGNvbG9ycGlja2VyIHBvcG92ZXIuXG4gICAqL1xuICBASW5wdXQoKSBzd2F0Y2hDb2xvcnM6IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIG1ha2UgdGhlIGhleCBjb2xvciBpbnB1dCByZWFkb25seS5cbiAgICovXG4gIEBJbnB1dCgpIEBJbnB1dEJvb2xlYW4oKSByZWFkb25seUlucHV0ID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgd2hpY2ggdGFiIGlzIHZpc2libGUgd2hlbiBwb3BvdmVyIG9wZW5zLlxuICAgKi9cbiAgQElucHV0KCkgZGVmYXVsdFNlbGVjdGVkVGFiOiAnc3dhdGNoZXMnIHwgJ2N1c3RvbScgPSAnc3dhdGNoZXMnO1xuXG4gIC8qKlxuICAgKiBDb25maWd1cmVzIHRvIHNob3cgYm90aCBvciB3aGljaCBvbmUgb2YgdGhlIGNvbG9yIHNlbGVjdGlvbiBpbnRlcmZhY2VzLlxuICAgKi9cbiAgQElucHV0KCkgdmFyaWFudDogJ2Jhc2UnIHwgJ3N3YXRjaGVzJyB8ICdjdXN0b20nO1xuXG4gIGNvbG9yOiBzdHJpbmc7XG5cbiAgdWlkID0gdW5pcXVlSWQoJ2NvbG9ycGlja2VyJyk7XG5cbiAgb3BlbjogYm9vbGVhbjtcblxuICBkaXNhYmxlZDogYm9vbGVhbjtcblxuICBoZXhDdXJyZW50ID0gJyNGRkYnO1xuICBoc3ZDdXJyZW50ID0gZ2V0SHN2RnJvbUhleCh0aGlzLmhleEN1cnJlbnQpO1xuXG4gIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIEBJbmplY3QoTkdMX0NPTE9SUElDS0VSX0NPTkZJRykgZGVmYXVsdENvbmZpZzogTmdsQ29sb3JwaWNrZXJDb25maWcsXG4gICAgICAgICAgICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXG4gICAgICAgICAgICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICAgICAgICAgICAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ3NsZHMtY29sb3ItcGlja2VyJyk7XG5cbiAgICBjb25zdCBjb25maWcgPSB7IC4uLm5ldyBOZ2xDb2xvcnBpY2tlckNvbmZpZygpLCAuLi5kZWZhdWx0Q29uZmlnIH07XG4gICAgdGhpcy5zd2F0Y2hDb2xvcnMgPSBjb25maWcuc3dhdGNoQ29sb3JzO1xuICAgIHRoaXMudmFyaWFudCA9IGNvbmZpZy52YXJpYW50O1xuICB9XG5cbiAgb25DaGFuZ2UgPSAoXzogYW55KSA9PiB7fTtcblxuICBvblRvdWNoZWQgPSAoKSA9PiB7fTtcblxuICB3cml0ZVZhbHVlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmNvbG9yID0gdmFsdWUgfHwgJyc7XG4gICAgaWYgKGlzVmFsaWRIZXgodmFsdWUpKSB7XG4gICAgICB0aGlzLmhleEN1cnJlbnQgPSB2YWx1ZTtcbiAgICAgIHRoaXMuaHN2Q3VycmVudCA9IGdldEhzdkZyb21IZXgodmFsdWUpO1xuICAgIH1cblxuICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogKHZhbHVlOiBhbnkpID0+IGFueSk6IHZvaWQgeyB0aGlzLm9uQ2hhbmdlID0gZm47IH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gYW55KTogdm9pZCB7IHRoaXMub25Ub3VjaGVkID0gZm47IH1cblxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pIHsgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7IH1cblxuICBvblN3YXRjaFNlbGVjdGlvbihoZXg6IHN0cmluZykge1xuICAgIHRoaXMuaHN2Q3VycmVudCA9IGdldEhzdkZyb21IZXgoaGV4KTtcbiAgICB0aGlzLmhleEN1cnJlbnQgPSBoZXg7XG4gIH1cblxuICBvbkN1c3RvbVNlbGVjdGlvbihoc3Y6IElIU1YpIHtcbiAgICB0aGlzLmhzdkN1cnJlbnQgPSBoc3Y7XG4gICAgdGhpcy5oZXhDdXJyZW50ID0gZ2V0SGV4RnJvbUhzdihoc3YpO1xuICB9XG5cbiAgb3BlbkNoYW5nZShvcGVuOiBib29sZWFuKSB7XG4gICAgdGhpcy5vcGVuID0gb3BlbjtcbiAgfVxuXG4gIGNhbmNlbCgpIHtcbiAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgfVxuXG4gIGRvbmUoKSB7XG4gICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuaGV4Q3VycmVudCAhPT0gdGhpcy5jb2xvcikge1xuICAgICAgdGhpcy5jb2xvciA9IHRoaXMuaGV4Q3VycmVudDtcbiAgICAgIHRoaXMub25DaGFuZ2UodGhpcy5jb2xvcik7XG4gICAgfVxuICB9XG5cbiAgY2FuQXBwbHkoKSB7XG4gICAgcmV0dXJuIGlzVmFsaWRIZXgodGhpcy5oZXhDdXJyZW50KTtcbiAgfVxuXG4gIG9uSW5wdXQoaGV4OiBzdHJpbmcpIHtcbiAgICB0aGlzLmNvbG9yID0gaGV4O1xuXG4gICAgaWYgKGlzVmFsaWRIZXgoaGV4KSkge1xuICAgICAgdGhpcy5vblN3YXRjaFNlbGVjdGlvbihoZXgpO1xuICAgICAgdGhpcy5vbkNoYW5nZShoZXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9uQ2hhbmdlKG51bGwpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBpc1ZhbGlkSW5wdXQoKSB7XG4gICAgcmV0dXJuICF0aGlzLmNvbG9yIHx8IGlzVmFsaWRIZXgodGhpcy5jb2xvcik7XG4gIH1cbn1cbiJdfQ==